<!DOCTYPE html>
<html lang="fr">
<head>
 <meta charset="utf-8" />
 <title>html home</title>
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <link rel="stylesheet" href="index.css" />
</head>
<body>
  <nav>
    <a href="index.html">html home</a>
    <a href="index.php">php home</a>
    <a href="todo.html">todo</a>
    <a href="traiteJs.html">traiteJs</a>
    <a href="aa_login.php">login</a>
  </nav>
  <h1>traiteJs</h1>
  <ul class="menu2">
    <li><a href="javascript:chargerSourceDeTest()">source de test</a></li>
  </ul>
  
  <!-- label>Nom du fichier Js<input name="NomDuJs" id="NomDuJs" value="" style="border: 1px lightgrey inset;" /></label -->
  <div id="zone_global_messages"></div>
  <br />
  <textarea class="txtar1" id="txtar1" rows="4"></textarea>
  <a href="javascript:transform()">transform</a>
  
  <div id="resultat1"></div>
  
  <textarea class="txtar1" id="txtar2" rows="4"></textarea>
  
  
  <script type="text/javascript" src="js/core4.js"></script>
  <script type="text/javascript" src="js/compile1.js"></script>
  <script type="text/javascript" src="js/javascript.js"></script>
<script type="text/javascript">


/*
var b=false;
if( ! b){
 alert('a');
}
*/
/*
BUG !!!!!!!
var a=1;
var b=1+(a==0?4:5);
console.log('b='+b); // b=6
var b=1+ a==0?4:5 ; // on retire les parenthèses
console.log('b='+b); // b=5
*/
/*
var a='a+2*p(1+p(a+1))';
var b=a.replace( /p\((.*)\)/   , '($1)' ).replace( /p\((.*)\)/   , '($1)' );
alert(b);
*/

//=====================================================================================================================
function recurf1(tab,niveau,ind,parentId,parentEstCascade){

 var estCascade=false;
 var t='';
 var l01=tab.length;
 var cascade=false;
 var parentEstFonction=false;
 for( var i=ind;i<l01;i++){
 
  if(tab[i][2]==parentId){
  
  
   if(tab[i][5]=='func'){
   
    if(tab[tab[i][2]][5]=='func'){
    
     if(t!==''){
      t+=',';
     }
     if(estCascade==false){
      t+='p(';
     }
     
    }else{
    
     if(t!==''){
      t+=',';
     }
     
    }
    // si le parent est une cascade et que c'est la première fonction et que la cascade contient plus d'une fonction
    if(tab[parentId][7]==1 && tab[i][6]==1 && tab[parentId][3]>1 ){ 
     t+='cascade(';
     estCascade=true;
    }
    
    if(tab[i][4]=='function'){
     parentEstFonction=true;
     t+='appelf(';
    }else{
     t+='appelf(';
    }
    // todo, traiter ici le element()
    if(tab[i][4].indexOf('.')>0){
     t+='  element('+tab[i][4].substr(0,tab[i][4].indexOf('.'))+'),';
     t+='  n('+tab[i][4].substr(tab[i][4].indexOf('.')+1)+')';
    }else if(tab[i][4].indexOf('.')==0){
     var n=tab[i][4].substr(1);
     if(n.indexOf('.')>0){
      t+='  element('+n.substr(0,n.indexOf('.'))+'),';
      t+='  n('+n.substr(n.indexOf('.')+1)+')';
     }else{
      t+='  n('+n+')';
     }
    }else{
     t+='  n('+tab[i][4]+')';
    }
    niveau++;
    var obj=recurf1(tab,niveau,tab[i][1]+1,tab[i][1],estCascade);
    niveau--;
    if(obj.status==true){
     t+=obj.value;
     if(tab[i][4]=='function'){
      t+=',contenu(';
     }else{
      t+=')';
     }
     if(tab[tab[i][2]][5]=='func' ){
      if(estCascade==false){
       if(tab[tab[i][2]][5]=='func'){
        t+=')'; // fermeture du p(
       }
      }else{
       // mais si c'est le dernier élément de la cascade
       if(tab[i][6]==tab[tab[i][2]][3] && estCascade){
        t+=')';
       }
      }
     }else{
      // mais si c'est le dernier élément de la cascade
      if(tab[i][6]==tab[tab[i][2]][3] && estCascade){
       t+=')';
      }
     }
    }else{
     temp={'status':false,'line':tab[ind][5],'message':'recurf1 1'};
     return(logerreur(temp));
    }
    // si le parent est une cascade et que c'est la première fonction et que la cascade contient plus d'une fonction
    if(tab[parentId][7]==1 && tab[i][6]==tab[parentId][3] && tab[parentId][3]>1 && parentEstCascade ){ 
     t+=')'; // on ferme la cascade;
    }
    
    
    
   }else if(tab[i][5]=='elem'){
    t+=',prop('+tab[i][4]+')';
   }else{
    if(tab[tab[i][2]][5]=='func'){ // si le parent est une fonction
     if(tab[i][6]>1){ // si c'est le nième enfant > 1
      t+=','
     }
     if(tab[i][5]=='oper'){
      t+='o('+tab[i][4]+')';
     }else{
      t+='p('+tab[i][4]+')';
     }
    }else{
     if(tab[i][6]>1){ // si c'est le nième enfant > 1
      if(tab[i][4]=='{'){  // dans le cas de affcte fonction
      }else{
       t+=','
      }
     }
     if(tab[i][5]=='cstt'){
      if(tab[i][4]=='{'){
//       t+='contenu('; // dans le cas de affcte fonction
      }else{
       t+=''+tab[i][4]+'';
      }
     }else if(tab[i][5]=='oper'){
      t+='o('+tab[i][4]+')';
     }
     // une constante peut avoir des enfants dans le cas de parenthèses, par exemple :
     // a='a'+(n+1)+'b'
     if(tab[i][3]>0){
      var obj=recurf1(tab,niveau,tab[i][1]+1,tab[i][1],false);
      if(obj.status==true){
       t+='p(';
       t+=obj.value;
       t+=')';
      }else{
       temp={'status':false,'line':tab[ind][5],'message':'recurf1 1'};
       return(logerreur(temp));
      }
     }
    }
   }
  }
 }
// console.log('ici pour ind='+ind+', t='+t);
 return {'status':true,'value':t,'parentEstFonction':parentEstFonction}
}
//console.log('test de traiteQuotes1='+traiteQuotes1('\'a\' + d + "e"'));

//p("b"),o(+)p(p(n),o(+),p(1)),o(+),p("c"),o(+),p(n),o(+),p("d")

//=====================================================================================================================
function traiteQuotes1(ch){
// console.log('traiteQuotes1 debut ch='+ch);
 var l01=ch.length;
 var c1='';
 var c2='';
 var out='';
 var dansSimpleQ=false;
 for(var i=0;i<l01;i++){
  c1=ch.substr(i,1);
  c2='';
  if(i-1>0){
   c2=ch.substr(i-1,1);
  }
  if(c1=='\''){
   if(c2=='\\'){
    // ok 
    out+=c1;
   }else{
    if(dansSimpleQ){
     dansSimpleQ=false;
    }else{
     dansSimpleQ=true;
    }
    out+='"';
   }
  }else if(c1=='"'){
   if(dansSimpleQ){
    if(c2=='\\'){
     out+=c1;
    }else{
     out+='\\'+c1;
    }
   }else{
    out+=c1;
   }
  }else{
   out+=c1;
  }
//  console.log('out="'+out+'"');
 }
// console.log('traiteQuotes1 fin='+out)
 return out;
}
//=====================================================================================================================
function analyseChaineParElements1(tab,ind,niveau,ch){

 var tab2=[];
 var t='';
 var variable1='';
 var niveau=0;
 var c1='';
 var c2='';
 var dansChaineDouble=false;
 var dansChaineSimple=false;
 var i=0;
 var j=0;
 var k=0;
 var l01=0;
 var id=0;
 var parentId=0;
 var declarationDeVariable='';
 
 ch=monTrim(ch);
 if(ch.substr(0,3)=='var'){
  declarationDeVariable='var ';
  ch=ch.substr(3);
  ch=monTrim(ch);
 }
 console.log('on entre dans analyseChaineParElements1 avec ch='+declarationDeVariable+ch);
 
 //         0niveau , 1id  , 2parentId    3nbEnf     4variable   5typ  , 6numéroEnfant   7cascade , 8positionFin
 tab2.push([  -1    , id   ,  parentId ,  0        , variable1 , ''    , 0             , 0        , 0            ]);
 
 l01=ch.length;
 // phase 1 : séparation des parenthèses
 for(i=0;i<l01;i++){
  var c1=ch.substr(i,1);
  if(i<l01-1){
   c2=ch.substr(i+1,1);
  }else{
   c2='';
  }
  if(dansChaineDouble){
  
   variable1+=c1;
   if(c1=='"'){
    dansChaineDouble=false;
   }else{
   
    for(j=i+1;j<l01;j++){
     c2=ch.substr(j,1);
     c1=ch.substr(j-1,1);
     if(c2=='"'){
      if(c1=='\\'){
       variable1+=c2;
      }else{
       variable1+=c2;
       dansChaineDouble=false;
       i=j;
       break;
      }
     }else{
      variable1+=c2;
     }
    }
   }
   
  }else if(dansChaineSimple){
  
   variable1+=c1;
   if(c1=='\''){
    dansChaineSimple=false;
   }else{
   
    for(j=i+1;j<l01;j++){
     c2=ch.substr(j,1);
     c1=ch.substr(j-1,1);
     if(c2=='\''){
      if(c1=='\\'){
       variable1+=c2;
      }else{
       variable1+=c2;
       dansChaineSimple=false;
       i=j;
       break;
      }
     }else{
      variable1+=c2;
     }
    }
   }
   
  
  
  }else if(c1==','){
  
   variable1=variable1.replace(/\n/g,' ')
   variable1=monTrim(variable1);
   if(variable1!==''){
    id++;
    tab2.push([ niveau,id,parentId,0 , traiteQuotes1(variable1) , 'cstt' , 0 , 0 , i-1]);
   }
   variable1='';
  
  }else if(c1=='('){
  
   variable1=variable1.replace(/\n/g,' ')
   variable1=monTrim(variable1);
   
   if(variable1!==''){
    id++;
    tab2.push([ niveau,id,parentId,0 , variable1 , 'func' , 0 , 0 , i-1]);
   }
   niveau++;
   variable1='';
   
  }else if(c1==')'){
  
   variable1=variable1.replace(/\n/g,' ')
   variable1=monTrim(variable1);
   if(variable1!==''){
    if(variable1.substr(0,1)=='.'){
     id++;
     tab2.push([ niveau+1,id,parentId,0 , variable1.substr(1) , 'elem' , 0 , 0 , i-1 ]);
    }else{
     id++;
     tab2.push([ niveau,id,parentId,0 , traiteQuotes1(variable1) , 'cstt' , 0 , 0 , i-1 ]);
    }
   }
   variable1='';
   niveau--;
   
  }else if(c1=='\''){
  
   dansChaineSimple=true;
   variable1+=c1;
   
  }else if(c1=='"'){
  
   dansChaineDouble=true;
   variable1+=c1;
   
  }else if(c1=='='){
  
   if(variable1!==''){
    if(variable1.substr(0,1)=='.'){
     id++;
     tab2.push([ niveau+1,id,parentId,0 , variable1.substr(1) , 'elem' , 0 , 0 , i-1 ]);
    }else{
     id++;
     tab2.push([ niveau  ,id,parentId,0 , traiteQuotes1(variable1) , 'cstt' , 0 , 0 , i-1 ]);
    }
    variable1='';
   }

   id++;
   tab2.push([ niveau,id,parentId,0 , c1 , 'a' , 0 , 0 , i ]);



  }else if(c1=='+' || c1=='-' || c1=='*' || c1=='/'){
   if(variable1!==''){
    if(variable1.substr(0,1)=='.'){
     id++;
     tab2.push([ niveau+1,id,parentId,0 , variable1.substr(1) , 'elem' , 0 , 0 , i-1 ]);
    }else{
     id++;
     tab2.push([ niveau,id,parentId,0 , traiteQuotes1(variable1) , 'cstt' , 0 , 0 , i-1 ]);
    }
    variable1='';
   }
  
   if(c2=='='){
    id++;
    tab2.push([ niveau,id,parentId,0 , c1+c2 , 'incr' , 0 , 0 , i+1 ]);
    i++;
   }else{
    id++;
    tab2.push([ niveau,id,parentId,0 , c1 , 'oper' , 0 , 0 , i ]);
   }
  
  }else if(c1 == ' '){
   // un espace ne sert à rien dans un javascript en dehors d'une constante, d'un new
   if(variable1=='new'){
    variable1+=c1;
   }
   
  }else{
  
   variable1+=c1;
   
  }
 }
 
 
 variable1=variable1.replace(/\n/g,' ')
 variable1=monTrim(variable1);
 if(variable1!==''){
  id++;
  if(variable1.substr(0,1)=='.'){
   tab2.push([ niveau+1,id,parentId,0 , variable1.substr(1) , 'elem' , 0 , 0 , i ]);
  }else{ 
   tab2.push([ niveau,id,parentId,0 , variable1 , 'cstt' , 0 , 0 , i ]);
  }
 }
 
 l01=tab2.length;
 
 for(var i=l01-1;i>=1;i--){
  var niv=tab2[i][0];
  for(var j=i-1;j>=1;j--){
   if(niv>tab2[j][0]){
    tab2[i][2]=tab2[j][1]; // numéro de parent
    break;
   }
  }
 }
 
 for(i=0;i < l01;i=i+1){
  k=0;
  for(j=i+1;j < l01;j=j+1){
   if(tab2[j][0] > tab2[i][0]){
    if(tab2[j][2] == tab2[i][1] ){
     k=k+1;
     tab2[j][6]=k; // numéro d'enfant
    }
   }else{
    break;
   }
  }
 }
 
 
 
 for(var i=l01-1;i>0;i--){
  var par=tab2[i][2];
  tab2[par][3]++; // nb enfants
 }
 

 // si le parent est une fonction ou est 0 et tous les enfants sont des f ( car il n'y a pas de n() ) 
 // alors, on doit ajouter une cascade
 for(i=0;i < l01;i=i+1){
  // si c'est une fonction qui est le premier enfant
  if(tab2[i][5]=='func' && tab2[i][6]==1){
   var parentId=tab2[i][2];
   var estCascade=1;
   for(j=i+1;j<l01;j++){
    if(tab2[j][2] == parentId){
     if(tab2[j][5]=='func' ){
     }else{
      estCascade=0;
      break;
     }
    }
   }
   if(estCascade==1){
    tab2[tab2[i][2]][7]=1; // le parent est une cascade
   }
  
  }
 }
 
/*
document.getElementById("global_messages").innerHTML+= '<div class="yyerror">' + global_messages.errors[i] + "</div>";
0123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789
[
 [-1  ,  0  ,  0  ,  7  ,  ""                             ,  ""      ,  0  ,  0  ,    0 ]  ,  
 [ 0  ,  1  ,  0  ,  2  ,  "document.getElementById"      ,  "func"  ,  1  ,  0  ,   22 ]  ,  
 [ 1  ,  2  ,  1  ,  0  ,  "\"global_messages\""          ,  "cst"   ,  1  ,  0  ,   40 ]  ,  
 [ 1  ,  3  ,  1  ,  0  ,  "innerHTML"                    ,  "elem"  ,  2  ,  0  ,   51 ]  ,  
 [ 0  ,  4  ,  0  ,  0  ,  "+="                           ,  "incr"  ,  2  ,  0  ,   53 ]  ,  
 [ 0  ,  5  ,  0  ,  0  ,  " '<div class=\"yyerror\">' "  ,  "cst"   ,  3  ,  0  ,   78 ]  ,  
 [ 0  ,  6  ,  0  ,  0  ,  "+"                            ,  "ope"   ,  4  ,  0  ,   79 ]  ,  
 [ 0  ,  7  ,  0  ,  0  ,  " global_messages.errors[i] "  ,  "cst"   ,  5  ,  0  ,  106 ]  ,  
 [ 0  ,  8  ,  0  ,  0  ,  "+"                            ,  "ope"   ,  6  ,  0  ,  107 ]  ,  
 [ 0  ,  9  ,  0  ,  0  ,  "\"</div>\";"                  ,  "cst"   ,  7  ,  0  ,  118 ]
]
*/ 
 // on essaie de repérer si il y a une affectation
 console.log('===========================\nle tableau est construit pour la chaine ch='+ch+'\ntab2=',JSON.stringify(tab2).replace(/\],/g,'],\n'));
 var operation=''; 
 for(i=1;i<l01;i++){
  c1=tab2[i][4].substr(0,1);
  c2=tab2[i][4].substr(1,1);
  if(tab2[i][0]==0 && ( c1=='=' || ( (c1 == '+' ||  c1 == '-' ||  c1 == '*' ||  c1 == '/' ) && c2=='=' ) ) ){
   // c'est une affectation
   operation=tab2[i][4];
   c1=ch.substr(0,tab2[i][8]-tab2[i][4].length+1);
   c2=ch.substr(tab2[i][8]+tab2[i][4].length);
   c2=monTrim(c2);
   if(c2.substr(c2.length-1,1)==';'){
    c2=c2.substr(0,c2.length-1);
   }
   console.log('c1=',c1,'\nc2=',c2);
   break;
  }
 }

 if(operation!=''){
  var uneConcatenation=false;
  if(operation=='+=' || operation=='-=' || operation=='*=' || operation=='/='){
   uneConcatenation=true;
  }
 
  var obj1=analyseChaineParElements1(tab,ind,niveau,c1);
  if(obj1.status==true){
   console.log('obj1 ok, operation="'+operation+'", obj1.value='+obj1.value.gauche.value);
   
   var tableau1=iterateCharacters2(obj1.value.gauche.value);
   var matriceFonction1=functionToArray2(tableau1.out,true,true);
   if(matriceFonction1.status==true){
    console.log('matriceFonction1.value='+JSON.stringify(matriceFonction1.value).replace(/\],/g,'],\n'));
    var objRecompose1=a2F1(matriceFonction1.value,0,false,1,false);
    if(objRecompose1.status===false){
     return logerreur({'status':false,'line':tab[ind][5],'message':'analyseChaineParElements1 objRecompose1'});
    }
    if(declarationDeVariable!==''){
     declarationDeVariable=objRecompose1.value;
    }
    console.log('objRecompose1=' , objRecompose1);
   }else{
    return logerreur({'status':false,'line':tab[ind][5],'message':'analyseChaineParElements1 matriceFonction1'});
   }
    
   
/*

,
p('<div class=\"yyerror\">' ),
p(+),
p( global_messages.errors[i] ),
p(+),
p( \"</div class=\\\"toto\\\">\" ),
p(+),
appelf(  n(toto),p(a),p('b')))

*/   
   var obj2=analyseChaineParElements1(tab,ind,niveau,c2);
   if(obj2.status==true){
    console.log('obj2 ok, operation="'+operation+'", obj2.value="'+obj2.value+'", obj2.tab2=\n'+JSON.stringify(obj2.tab2).replace(/\],/g,'],\n'));
    
    // analyse du tableau pour savoir si c'est une éventuelle concaténation de chaine 
    var concatenationChaine=false;
    if(operation=='+=' || operation=='='){
     var queDesPlus=false;
     var auMoinsUneChaine=false;
     var queDesOperationsEtDesConstantes=true;
     for(i=1;i<obj2.tab2.length;i++){
      if(obj2.tab2[i][5]=='oper'){
       if(obj2.tab2[i][4]=='+'){
        queDesPlus=true;
       }else{
        queDesPlus=false;
        break
       }
      }else if(obj2.tab2[i][5]=='cstt'){
       if(obj2.tab2[i][4].substr(0,1)=='\'' || obj2.tab2[i][4].substr(0,1)=='"' ){
        auMoinsUneChaine=true;
       }
      }else{
       queDesOperationsEtDesConstantes=false;
      }
     }
     if(queDesPlus && auMoinsUneChaine){
      concatenationChaine=true;
     }
    }
    
    if(concatenationChaine){
     console.log('vrai concatenationChaine');
     var tempch2=obj2.value.gauche.value;
     if(tempch2.substr(0,1)==','){
      tempch2=tempch2.substr(1);
     }
     if(operation=='+='){
      // "b",+(n,+,1),+,"c",+,n,+,"d"
      
      tempch2='affecte('+objRecompose1.value+',appelf(n(concat),p('+objRecompose1.value+'),p('+tempch2.replace(/,\+,/g,'),p(')+')))';
     }else{
      tempch2='affecte('+objRecompose1.value+',appelf(n(concat),p('+tempch2.replace(/,\+,/g,'),p(')+')))';
     }
     
     console.log('tempch2=',tempch2);
     return {'status':true,value:{'declarationDeVariable':declarationDeVariable,'operation':operation,'gauche':{'status':true,'value':tempch2},'droite':null}};
     
    }else{
     if(operation=='='){
     
      tempch2=obj2.value.gauche.value;
      
      if(queDesOperationsEtDesConstantes){
 //      console.log(' à gauche '+obj2.value.gauche.value);
       tempch2=tempch2.replace(/\,o\(\+\)\,/g,'+').replace(/\,o\(\+\)/g,'+').replace(/o\(\+\)\,/g,'+');
       tempch2=tempch2.replace(/\,o\(\-\)\,/g,'-').replace(/\,o\(\-\)/g,'-').replace(/o\(\-\)\,/g,'-');
       tempch2=tempch2.replace(/\,o\(\*\)\,/g,'*').replace(/\,o\(\*\)/g,'*').replace(/o\(\*\)\,/g,'*');
       tempch2=tempch2.replace(/\,o\(\/\)\,/g,'/').replace(/\,o\(\/\)/g,'/').replace(/o\(\/\)\,/g,'/');
       var k=20; // on expère moins de 20 niveaux de parenthèses
       while(tempch2.indexOf('p(')>=0 && k-- > 0 ){
        tempch2=tempch2.replace( /p\((.*)\)/   , '($1)' );
       }

       if(tempch2.substr(0,4)=='obj('){
        tempch2='affecte('+objRecompose1.value+','+tempch2+')';
       }else{
        tempch2='affecte('+objRecompose1.value+',@('+tempch2+'))';
       }
      }else{
       if(obj2.value.gauche.parentEstFonction){
        tempch2='affecte('+objRecompose1.value+','+tempch2+''; // il y a contenu ici
       }else{
        tempch2='affecte('+objRecompose1.value+','+tempch2+')';
       }
      }
      return {'status':true,value:{'declarationDeVariable':declarationDeVariable,'operation':operation,'gauche':{'status':true,'value':tempch2,'parentEstFonction':obj2.value.gauche.parentEstFonction},'droite':null}};
      
     }else if(operation=='+='){
     
      var tempch2=obj2.value.gauche.value;
      if(tempch2.substr(0,1)==','){
       tempch2=tempch2.substr(1);
      }
      tempch2=tempch2.replace(/\,o\(\+\)\,/g,'+').replace(/\,o\(\+\)/g,'+').replace(/o\(\+\)\,/g,'+');
      tempch2=tempch2.replace(/\,o\(\-\)\,/g,'-').replace(/\,o\(\-\)/g,'-').replace(/o\(\-\)\,/g,'-');
      tempch2=tempch2.replace(/\,o\(\*\)\,/g,'*').replace(/\,o\(\*\)/g,'*').replace(/o\(\*\)\,/g,'*');
      tempch2=tempch2.replace(/\,o\(\/\)\,/g,'/').replace(/\,o\(\/\)/g,'/').replace(/o\(\/\)\,/g,'/');
/*
      var k=20; // on expère moins de 20 niveaux de parenthèses
      while(tempch2.indexOf('p(')>=0 && k -- > 0 ){
       tempch2=tempch2.replace( /p\((.*)\)/   , '($1)' );
      }
*/    
      if(tempch2.substr(0,6)=='appelf'){
       tempch2='affecte('+objRecompose1.value+',appelf(n(concat),p('+objRecompose1.value+'),p('+tempch2+')))';
      }else{
       tempch2='affecte('+objRecompose1.value+',appelf(n(concat),p('+objRecompose1.value+'),@('+tempch2+')))';
      }

      return {'status':true,value:{'declarationDeVariable':declarationDeVariable,'operation':operation,'gauche':{'status':true,'value':tempch2},'droite':null}};
     
     }else{
     
      debugger ; // todo
      return logerreur({'status':false,'line':tab[ind][5],'message':'analyseChaineParElements1 cas non traité pour operation="'+operation+'"'});
      
     }
    }
   }else{
    return logerreur({'status':false,'line':tab[ind][5],'message':'analyseChaineParElements1 err deuxième partie '});
   }
  }
  
 }else{ // pas d'opération
  // tab,niv,ind,parentId
  if(ch.indexOf('++')>0){
   var chaine=ch.replace(/\+\+/,'').replace(';','');
   var obj2=analyseChaineParElements1(tab,ind,niveau,chaine);
   if(obj2.status==true){
    var tempch2=obj2.value.gauche.value;
    tempch2='affecte('+tempch2+','+tempch2+'+1)';
    return {'status':true,value:{'declarationDeVariable':declarationDeVariable,'operation':operation,'gauche':{'status':true,'value':tempch2},'droite':null}};
     
   }else{
    return logerreur({'status':false,'line':tab[ind][5],'message':'analyseChaineParElements1 ++ non traité '});
   }
  }else if(ch.indexOf('--')>0){
   var chaine=ch.replace(/\-\-/,'').replace(';','');
   var obj2=analyseChaineParElements1(tab,ind,niveau,chaine);
   if(obj2.status==true){
    var tempch2=obj2.value.gauche.value;
    tempch2='affecte('+tempch2+','+tempch2+'-1)';
    return {'status':true,value:{'declarationDeVariable':declarationDeVariable,'operation':operation,'gauche':{'status':true,'value':tempch2},'droite':null}};
     
   }else{
    return logerreur({'status':false,'line':tab[ind][5],'message':'analyseChaineParElements1 ++ non traité '});
   }
  }else{
   console.log('appel recursif avec le tableau précédent '); // avec tableau tab2=\n'+JSON.stringify( tab2 ).replace(/\],/g,'],\n') +'')
   var obj1=recurf1(tab2,0,1,0,false);
   console.log('=====retour récursif obj1='+JSON.stringify(obj1)+'\n====================================');
   if(obj1.status==true){
   
    var queDesOperationsEtDesConstantes=true;
    for(i=1;i<tab2.length;i++){
     if(tab2[i][5]=='oper'){
     }else if(tab2[i][5]=='cstt'){
     }else{
      queDesOperationsEtDesConstantes=false;
     }
    }
    if(queDesOperationsEtDesConstantes){
     console.warn('queDesOperationsEtDesConstantes est vrai, obj1.value=',obj1.value);
     obj1.value=obj1.value.replace()
     obj1.value=obj1.value.replace(/\,o\(\+\)\,/g,'+').replace(/\,o\(\+\)/g,'+').replace(/o\(\+\)\,/g,'+');
     obj1.value=obj1.value.replace(/\,o\(\-\)\,/g,'-').replace(/\,o\(\-\)/g,'-').replace(/o\(\-\)\,/g,'-');
     obj1.value=obj1.value.replace(/\,o\(\*\)\,/g,'*').replace(/\,o\(\*\)/g,'*').replace(/o\(\*\)\,/g,'*');
     obj1.value=obj1.value.replace(/\,o\(\/\)\,/g,'/').replace(/\,o\(\/\)/g,'/').replace(/o\(\/\)\,/g,'/');
     if(tab2.length==2 && tab2[1][5]=='cstt'){
      obj1.value=''+obj1.value+'';
     }else{
      var k=20;
      while(obj1.value.indexOf('p(')>=0 && k-- > 0 ){
       obj1.value=obj1.value.replace( /p\((.*)\)/   , '($1)' );
      }
      if(obj1.value.substr(0,1)=='{' && obj1.value.substr(obj1.value.length-1,1)=='}'){
       obj1.value=''+objectify0(obj1.value)+'';
      }else{
       obj1.value='@('+obj1.value+')';
      }
     }
     
    }
    if(obj1.value.indexOf('),o(')>=0 && obj1.value.indexOf('),p(')){
     console.log('// on tente le coup avant = ', obj1.value);
     obj1.value=obj1.value.replace(/\)\,o\(\+\)\,p\(/g , '+' );
     obj1.value=obj1.value.replace(/\)\,o\(\-\)\,p\(/g , '-' );
     obj1.value=obj1.value.replace(/\)\,o\(\*\)\,p\(/g , '*' );
     obj1.value=obj1.value.replace(/\)\,o\(\/\)\,p\(/g , '/' );
     console.log('// on tente le coup après = ', obj1.value);
    }
   
    console.warn('apres transformation, obj1.value=',obj1.value);
   
    return {'status':true,value:{'declarationDeVariable':declarationDeVariable,'operation':operation,'gauche':obj1,'droite':null},'tab2':tab2};
   }
  }
 }
 return logerreur({'status':false,'line':tab[ind][5],'message':'analyseChaineParElements1'});
}
//=====================================================================================================================
function isObject(obj){
  if(Object.prototype.toString.call(obj) === '[object Object]'){
   return true;
  }else{
   return false;
  }
}
//=====================================================================================================================
function objectify1(o){
 var t='';
 for( var a in o){
  if(isObject(o[a])){
   var obj=objectify1(o[a]);
   if(obj.status===true){
    t+='(\''+a+'\' , obj('+obj.value+')),';
   }else{
    return {status:false,value:t};
   }
  }else{
   t+='(\''+a+'\' , '+o[a]+'),';
  }
 }
 if(t.length>0 && t.substr(t.length-1,1)==','){
  t=t.substr(0,t.length-1);
 }
 return {status:true,value:t};
}
//=====================================================================================================================
function objectify0(s){
 var t='';
 var o=JSON.parse(s);
 var obj1=objectify1(o);
 if(obj1.status==true){
  t+='obj(';
  t+=obj1.value;
  t+=')';
  return t;
 }else{
  return '#(TODO IN objectify0)';
 }
}
//=====================================================================================================================
function traiteDelimiteursChaine1(tab,ind,niveau,s,delim){
 var t='';
 var niveau=0;
 for(var i=0;i<s.length;i++){
  var c=s.substr(i,1)
  if(c==delim){
   if(i==0 || i==s.length-1){
    if(i==s.length-1){
     return {'status':true,'value':t};
    }
   }else{
    if(i>1 && s.substr(i-1,1)=='\\'){
     t=t.substr(0,t.length-1); //+(delim=='"'?'"':'\\\'');
     if(delim=='\''){
      t+='\\\''
     }else{
      t+='"'
     }
    }else{
     return logerreur({'status':false,'ind':ind,'value':s});
    }
   }
  }else{
   if(delim=='"' && c=='\''){
    t+='\\\'';
   }else{
    t+=c;
   }
  }
 }
 return {'status':true,'ind':ind,'value':s};
}

//=====================================================================================================================
function analyseChaineSimple1(tab,ind,niveau,chaine,noLogIfError){
 var t=chaine;
 var chaineQuotee=false;
 var isNum=false;
 var isComplex=false;
// console.log('chaine="'+chaine+'"');
 if(isNumeric(chaine)){
//  console.log(chaine+' EST NUMERIQUE');
  t=chaine.replace(/ /g,'');
  return {'status':true,'value':t,'chaineQuotee':chaineQuotee,'isNum':true,'isComplex':isComplex};
 }
 for (var i=0;i<chaine.length;i++){
  var c=chaine.substr(i,1);
  if(c!=' '){
   chaine=chaine.substr(i);
   break
  }
 }
 for(var i=chaine.length-1;i>=0;i--){
  var c=chaine.substr(i,1);
  if(c!=' '){
   chaine=chaine.substr(0,i+1);
   break
  }
 }
 if(chaine.substr(0,1)=='"' && chaine.substr(chaine.length-1,1)=='"'){
  chaineQuotee=true;
  var obj=traiteDelimiteursChaine1(tab,ind,niveau,chaine,'"');
  if(obj.status==true){
   t=obj.value;
  }
 }else if(chaine.substr(0,1)=='\'' && chaine.substr(chaine.length-1,1)=='\''){
  chaineQuotee=true;
  var obj=traiteDelimiteursChaine1(tab,ind,niveau,chaine,'\'');
  if(obj.status==true){
   t=obj.value;
  }
 }else{
  t=chaine;
 }
 if(chaineQuotee){
  if(noLogIfError==true){
   return {'status':true,'ind':ind,'value':t,'chaineQuotee':chaineQuotee,'isNum':false,'isComplex':isComplex,'message':'analyseChaineSimple1 1 Erreur , ind="'+ind+'" '};
  }else{
   return logerreur({'status':true,'ind':ind,'value':t,'chaineQuotee':chaineQuotee,'isNum':false,'isComplex':isComplex,'message':'analyseChaineSimple1 1 Erreur , ind="'+ind+'" '});
  }
 }
 var tab1=', \' " < > ! = & | ( ) ?'.split(' ');
 for(var i=0 ; i < t.length && isComplex==false ; i++ ){
  var c=t.substr(i,1);
  for(var j=0;j<tab1.length;j++){
   if(tab1[j]===c){
    isComplex=true;
    break;
   }
  }
 }
 

 if(isComplex==false){
  return {'status':true,'value':t,'chaineQuotee':chaineQuotee,'isNum':false,'isComplex':isComplex};
 }
 
 // si on arrive ici, c'est q'on a probablement une fonction,
 // au pire, pour l'instant : a.b.c(d,'e').f(g[h][i]) * (x>0&&!(!1==false)?4:5)
 // les délimiteur sont . , ' " < <= > >= != == === !== & | && || ( ) ? ! true false + - * /
 if(noLogIfError==true){
  return {'status':false,'line':tab[ind][5],isComplex:isComplex,'message':'analyseChaineSimple1 2 1 Erreur'};
 }else{
  return logerreur({'status':false,'line':tab[ind][5],isComplex:isComplex,'message':'analyseChaineSimple1 2 2 Erreur'});
 }
 
 
}
//=====================================================================================================================
function traiteEgaliteSimple1(tab,ind,niveau,s){
 var t='';
 s=s.replace(';','');
 var tt=s.split('=');
 if(tt.length==2){
   var obj1=analyseChaineSimple1(tab,ind,niveau , tt[0],true);
   var obj2=analyseChaineSimple1(tab,ind,niveau , tt[1],true);
   if(obj1.status===true && obj1.isComplex===false){
    if(obj2.status===true  && obj1.isComplex===false ){
     t+='\n'+' '.repeat(niveau*NBESPACESREV)+'declare(';
     if(obj1.chaineQuotee || obj1.isNum || obj1.isComplex ){
      temp={'status':false,'line':tab[ind][5],'message':'4 traiteEgaliteSimple1 problème dans une déclaration de variable'};
      return(logerreur(temp));
     }else{
      t+=obj1.value+'';
     }
     t+=' , ';
     if(obj2.chaineQuotee){
      t+='\''+obj2.value+'\'';
     }else if(obj2.isNum){
      t+=obj2.value+'';
     }else if(obj2.isComplex==false){
      t+=obj2.value+'';
     }else{
      temp={'status':false,'line':tab[ind][5],'message':'4 traiteEgaliteSimple1 problème dans une déclaration de variable '+JSON.stringify(tab[ind])};
      return(logerreur(temp));
     }
     t+=')';
    }else{
     if(obj2.status===false  && obj2.isComplex===true ){
      var obj2=analyseChaineParElements1(tab,ind,niveau,tt[1]);
      if(obj2.status===true){
      
       t+='\n'+' '.repeat(niveau*NBESPACESREV)+'declare(';
       t+=obj1.value + ' , ';
       t+=obj2.value.gauche.value;
       t+=')';
       
      }else{
       temp={'status':false,'line':tab[ind][5],'message':'3 traiteEgaliteSimple1 dans analyseChaineParElements1, objch1='+JSON.stringify(obj2)+' '+JSON.stringify(tab[ind])};
       return(logerreur(temp));
      }
     }else{
      temp={'status':false,'line':tab[ind][5],'message':'2 traiteEgaliteSimple1 problème dans une déclaration de variable, obj2='+JSON.stringify(obj2)+''};
      return(logerreur(temp));
     }
    }
   }else{
    var obj1=analyseChaineParElements1(tab,ind,niveau,s);
    if(obj1.status===true){
     t=obj1.value;
     return {'status':true,'value':t,'fermetureNiveau':0,'ajouterNiveauDedans':0,'gauche':obj1.gauche,'droite':obj1.droite};
     
    }else{
     temp={'status':false,'line':tab[ind][5],'message':'1 1 traiteEgaliteSimple1 problème dans une déclaration de variable, obj1='+JSON.stringify(obj1)+''};
     return(logerreur(temp));
    }
   }
 }else{
  // ce n'est pas un égalité simple = on ne met pas de message
   temp={'status':false};
   return(logerreur(temp));
 }
 return {'status':true,'value':t,'fermetureNiveau':false,'ajouterNiveauDedans':0,'gauche':obj1,'droite':obj2};
}
//=====================================================================================================================
function traiteDeclarationVariable1(tab,ind,niveau,dansFor){
 var t='';
 var ligne='';
 if(dansFor!==''){
  ligne=dansFor;
 }else{
  ligne=tab[ind][4];
 }
 var s=ligne.substr(4);
 var obj1=traiteEgaliteSimple1(tab,ind,niveau,s);
 if(obj1.status===true){
  t=obj1.value;
  return {'status':true,'value':t,'fermetureNiveau':0,'ajouterNiveauDedans':0,'gauche':obj1.gauche,'droite':obj1.droite};
 }else{
 
  obj1=analyseChaineParElements1(tab,ind,niveau,s);
  if(objinit.status==false){
   return logerreur({'status':false,'message':'Erreur traiteDeclarationVariable1 la declaration ne fonctionne pas','line':tab[ind][5]});
  }
  return {'status':true,'value':t,'fermetureNiveau':0,'ajouterNiveauDedans':0,'gauche':obj1.gauche,'droite':obj1.droite};
 }
}
//=====================================================================================================================
function decomposeConditionEnTableau1(tab,ind,niveau,ch){

 var tab1=[];
 var t='';
 var variable1='';
 var niveau=0;
 var c1='';
 var dansChaineDouble=false;
 var dansChaineSimple=false;
 var i=0;
 var j=0;
 var l01=ch.length;
 var id=0;
 var parentId=0;
 //           niveau , id  , parentId    nbEnf     1            2   3avant   4apres
 tab1.push([ [niveau , id  , parentId ,  0     ] , variable1 , [] , ''      , ''     , '' , [[ '' , '' , [ '' , '' , '' ] ]] ]);
 
 // phase 1 : séparation des parenthèses
 for(i=0;i<l01;i++){
  var c1=ch.substr(i,1);
  if(dansChaineDouble){
  
   variable1+=c1;
   if(c1=='"'){
    dansChaineDouble=false;
   }else{
   
    for(j=i+1;j<l01;j++){
     c2=ch.substr(j,1);
     if(c2=='"'){
      if(c1=='\\'){
       variable1+=c2;
      }else{
       variable1+=c2;
       dansChaineDouble=false;
       i=j;
       break;
      }
     }else{
      variable1+=c2;
     }
    }
   }
   
  }else if(dansChaineSimple){
  
   variable1+=c1;
   if(c1=='\''){
    dansChaineSimple=false;
   }else{
   
    for(j=i+1;j<l01;j++){
     c2=ch.substr(j,1);
     if(c2=='\''){
      if(c1=='\\'){
       variable1+=c2;
      }else{
       variable1+=c2;
       dansChaineSimple=false;
       i=j;
       break;
      }
     }else{
      variable1+=c2;
     }
    }
   }
   
  
  
  }else if(c1=='('){
   variable1=variable1.replace(/\n/g,' ')
   variable1=monTrim(variable1);
   
   if(variable1!==''){
    if(variable1.substr(variable1.length-1,1)=='!'){
     variable1=variable1.substr(0,variable1.length-1);
     variable1=monTrim(variable1);
     variable1+='!';
    }
    id++;
    tab1.push([ [niveau,id,parentId,0] , variable1 , [] , '' , '' , '' , [['' , '' , [ '' , '' , '' ] ]] ]);
   }
   niveau++;
   variable1='';
  }else if(c1==')'){
   variable1=variable1.replace(/\n/g,' ')
   variable1=monTrim(variable1);
   if(variable1!==''){
    id++;
    tab1.push([ [niveau,id,parentId,0] , variable1 , [] , '' , '' , '' , [['' , '' , [ '' , '' , '' ] ]] ]);
   }
   variable1='';
   niveau--;
  }else if(c1=='\''){
   dansChaineSimple=true;
   variable1+=c1;
  }else if(c1=='"'){
   dansChaineDouble=true;
   variable1+=c1;
  }else{
   variable1+=c1;
  }
 }
 
 
 variable1=variable1.replace(/\n/g,' ')
 variable1=monTrim(variable1);
 if(variable1!==''){
  id++;
  tab1.push([ [niveau,id,parentId,0] , variable1 , [] , '' , '' , '' , [[ '' , '' , [ '' , '' , '' ] ]] ]);
 }
 for(var i=tab1.length-1;i>=1;i--){
  var niv=tab1[i][0][0];
  for(var j=i-1;j>=1;j--){
   if(niv>tab1[j][0][0]){
    tab1[i][0][2]=tab1[j][0][1];
    break;
   }
  }
 }
 
 for(var i=tab1.length-1;i>0;i--){
  var par=tab1[i][0][2];
  tab1[par][0][3]++
 }

 //======================================================================
 // phase 2 : chaque groupe de parenthèse représente une ligne du tableau
 //======================================================================

 
 var niveauprecedent=999;
 var l01=tab1.length;
 // on sépare les && et ||
 
 for(i=1;i<l01;i++){
  c1=tab1[i][1];
  console.log('niveau et c1='+tab1[i][0][0]+'"'+c1+'"');
  //dans chaque ligne , on explose les && et les || 
  if(c1.length>=3){
   if(c1.substr(0,3)=='&&!' || c1.substr(0,3)=='||!'){
    tab1[i][3]=c1.substr(0,3);
    c1=c1.substr(3);
   }else if(c1.substr(0,2)=='&&' || c1.substr(0,2)=='||'){
    tab1[i][3]=c1.substr(0,2);
    c1=c1.substr(2);
   }
  }else if(c1.length>=2){
   if(c1.substr(0,2)=='&&' || c1.substr(0,2)=='||'){
    tab1[i][3]=c1.substr(0,2);
    c1=c1.substr(2);
   }
  }
  if(niveauprecedent<tab1[i][0][0] && c1!='' && tab1[i-1][4]=='' ){
   // si le niveau courant est inférieur au niveau suivant, la ligne doit de terminer par
   // un "&&!" ou un "||!" ou un "&&" ou un "||"
   if(i<l01-1){
    
    if(c1.length>=3){
     if(c1.substr(c1.length-3,3)=='&&!' || c1.substr(c1.length-3,3)=='||!'){
      tab1[i][4]=c1.substr(c1.length-3,3);
      c1=c1.substr(0,c1.length-3)
     }else if(c1.substr(c1.length-2,2)=='&&' || c1.substr(c1.length-2,2)=='||'){
      tab1[i][4]=c1.substr(c1.length-2,2);
      c1=c1.substr(0,c1.length-2)
     }else{
      return logerreur({'status':false,'id':ind,'line':tab[ind][5],'message':'un || ou un && devrait précéder une "(" dans une condition'});
     }
    }else if(c1.length>=2){
     if(c1.substr(c1.length-2,2)=='&&' || c1.substr(c1.length-2,2)=='||'){
      tab1[i][4]=c1.substr(c1.length-2,2);
      c1=c1.substr(0,c1.length-2)
     }else{
      return logerreur({'status':false,'id':ind,'line':tab[ind][5],'message':'un || ou un && devrait précéder une "(" dans une condition'});
     }
    }
   }
   
  }
  tab1[i][5]=c1;
  // tab1[i][5] contient des elements de type condition1 && condition2 || condition 3
  // dans tab1[i][6] on explose ces conditions sous la forme [['|et|ou','conditionX'],...]
  dansChaineDouble=false;
  dansChaineSimple=false;
  variable1='';
  var textEtOu='';
  var indiceCondition=0;
  
  for(var j=0;j<tab1[i][5].length-1;j++){
   c1=tab1[i][5].substr(j,1);
   textEtOu=tab1[i][5].substr(j,2);
   if(dansChaineDouble){
   
    variable1+=c1;
    if(c1=='"'){
     dansChaineDouble=false;
    }else{
    
     for(j=i+1;j<l01;j++){
      c2=ch.substr(j,1);
      if(c2=='"'){
       if(c1=='\\'){
        variable1+=c2;
       }else{
        variable1+=c2;
        dansChaineDouble=false;
        i=j;
        break;
       }
      }else{
       variable1+=c2;
      }
     }
    }
    
   }else if(dansChaineSimple){
   
    variable1+=c1;
    if(c1=='\''){
     dansChaineSimple=false;
    }else{
    
     for(j=i+1;j<l01;j++){
      c2=ch.substr(j,1);
      if(c2=='\''){
       if(c1=='\\'){
        variable1+=c2;
       }else{
        variable1+=c2;
        dansChaineSimple=false;
        i=j;
        break;
       }
      }else{
       variable1+=c2;
      }
     }
    }
   }else if(textEtOu=='&&' || textEtOu=='||'){
    tab1[i][6][indiceCondition][1]=monTrim(variable1);
    tab1[i][6].push([textEtOu,'',[ '' , '' , '' ]]);
    indiceCondition++;
    variable1='';
    j++;
   }else{
    variable1+=c1;
   }
  }
  variable1+=tab1[i][5].substr(tab1[i][5].length-1,1)
  tab1[i][6][indiceCondition][1]=monTrim(variable1);
  
   
  dansChaineDouble=false;
  dansChaineSimple=false;
  variable1='';
  var textTest1='';
  var textTest2='';
  var textTest3='';
  var indiceTest=0;
  
  for(var j=0;j<tab1[i][6].length;j++){
  
   var l02=tab1[i][6][j][1].length;
   var str1=tab1[i][6][j][1];
   
   for(var k=0;k<l02;k++){
   
    c1=str1.substr(k,1);
    textTest1=str1.substr(k,1);
    textTest2=str1.substr(k,2);
    textTest3=str1.substr(k,3);
    if(dansChaineDouble){
    
     variable1+=c1;
     if(c1=='"'){
      dansChaineDouble=false;
     }else{
     
      for(var l=k+1;l<l02;l++){
       c2=ch.substr(l,1);
       if(c2=='"'){
        if(c1=='\\'){
         variable1+=c2;
        }else{
         variable1+=c2;
         dansChaineDouble=false;
         k=l;
         break;
        }
       }else{
        variable1+=c2;
       }
      }
     }
     
    }else if(dansChaineSimple){
    
     variable1+=c1;
     if(c1=='\''){
      dansChaineSimple=false;
     }else{
     
      for(var l=k+1;l<l02;l++){
       c2=ch.substr(l,1);
       if(c2=='\''){
        if(c1=='\\'){
         variable1+=c2;
        }else{
         variable1+=c2;
         dansChaineSimple=false;
         k=l;
         break;
        }
       }else{
        variable1+=c2;
       }
      }
     }
    }else if(textTest3=='===' || textTest3=='!=='){
     tab1[i][6][j][2][0]=textTest3;
     tab1[i][6][j][2][1]=monTrim(str1.substr(0,k));
     tab1[i][6][j][2][2]=monTrim(str1.substr(k+3));
     break;
    }else if(textTest2=='==' || textTest2=='!='  || textTest2=='<=' || textTest2=='>='){
     tab1[i][6][j][2][0]=textTest2;
     tab1[i][6][j][2][1]=monTrim(str1.substr(0,k));
     tab1[i][6][j][2][2]=monTrim(str1.substr(k+2));
     break;
    }else if(textTest1=='>' || textTest1=='<'  ){
     tab1[i][6][j][2][0]=textTest1;
     tab1[i][6][j][2][1]=monTrim(str1.substr(0,k));
     tab1[i][6][j][2][2]=monTrim(str1.substr(k+1));
     break;
    }else{
     if(c1=='"'){
      dansChaineDouble=true;
     }else if(c1=='\''){
      dansChaineSimple=true;
     }else{
      variable1+=c1;
     }
    }   
   
   
   
   }
  }  
  niveauprecedent=tab1[i][0][0];
 }
 

// console.log('\n====ch=\n'+ch+'\n==== conditions ===========================\ntab1=',tab1);
 
 
 
 
 return {'status':true,'value':tab1}
 
}

//=====================================================================================================================
function boucleRecursiveSurCondition1(tab,ind1,niveau1,parentId){
 var t='';
 var dernierI=0;
 for(var i=ind1;i<tab.length;i++){
  if(tab[i][0][2]==parentId){
  
   if(tab[i][3]=='||'){
    t+='ou';
   }else if(tab[i][3]=='&&'){
    t+='et';
   }else{
    t+=tab[i][3];
   }
   
   if(tab[i][0][0]>niveau1){
    t+='('.repeat(tab[i][0][0]-niveau1);
   }
   if(tab[i][5]!==''){
//    t+=' untruc pour i='+i+' ';
    for(var j=0;j<tab[i][6].length;j++){
     var elt=tab[i][6][j];
     if(j>0){
      t+=',';
     }
     if(elt[0]=='||'){
      t+='ou';
     }else if(elt[0]=='&&'){
      t+='et';
     }
     if(elt[2][0]=='' && elt[2][1]=='' && elt[2][2]==''){
      t+='(';
       if(tab[i][6][j][1].substr(0,1)=='!'){
        t+='egalstricte('+tab[i][6][j][1].substr(1)+' , faux)';
       }else{
        t+='non(egalstricte('+tab[i][6][j][1]+' , faux))';
       }
      t+=')';
     }else{
      t+='(';
      if(elt[2][0]=='<'){
       t+='inf('+elt[2][1]+' , '+elt[2][2]+')';
      }else if(elt[2][0]=='<='){
       t+='infeg('+elt[2][1]+' , '+elt[2][2]+')';
      }else if(elt[2][0]=='>'){
       t+='sup('+elt[2][1]+' , '+elt[2][2]+')';
      }else if(elt[2][0]=='>='){
       t+='supegal('+elt[2][1]+' , '+elt[2][2]+')';
      }else if(elt[2][0]=='!=='){
       t+='diffstricte('+elt[2][1]+' , '+elt[2][2]+')';
      }else if(elt[2][0]=='==='){
       t+='egalstricte('+elt[2][1]+' , '+elt[2][2]+')';
      }else if(elt[2][0]=='!='){
       t+='diff('+elt[2][1]+' , '+elt[2][2]+')';
      }else if( elt[2][0] == '==' ){
       t+='egal('+elt[2][1]+' , '+elt[2][2]+')';
      }else{
       t+='TODO"'+elt[2][0]+'"('+elt[2][1]+' , '+elt[2][2]+')';
      }
      t+=')';
     }
    }
   }
   if(tab[i][4]=='||'){
    t+='ou';
   }else if(tab[i][4]=='&&'){
    t+='et';
   }else{
    t+=tab[i][4];
   }
   if(tab[i][0][3]>0){
    var obj=boucleRecursiveSurCondition1(tab,i+1,tab[i][0][0],tab[i][0][1]);
    if(obj.status==true){
     t+=obj.value;
    }else{
     return logerreur({'status':false,'message':'erreur recursif'});
    }
   }
   
   
   if(tab[i][0][0]>niveau1){
    t+=')'.repeat(tab[i][0][0]-niveau1);
   }

   
  }
 
 }
 return {'status':true,'value':t};
}

//=====================================================================================================================
function traiteConditionComplexe1(tab,ind,niveau,ch){
 var t='';
 var variable1='';
 var niveau=0;
 var c1='';
 var dansChaineDouble=false;
 var dansChaineSimple=false;
 var i=0;
 var j=0;
 var l01=ch.length;
 
 
 
 var obj1=decomposeConditionEnTableau1(tab,ind,niveau,ch);
 if(obj1.status===false){
  return logerreur({'status':false,'line':tab[ind][5]});
 }
 var tab1=obj1.value;

 var obj1=boucleRecursiveSurCondition1(tab1 , 1 , 0 , 0);
 console.log('apres recur condition, obj1=',obj1);
 if(obj1.status===false){
  return logerreur({'status':false,'line':tab[ind][5]});
 }else{
  t=obj1.value;
 }
 
 
 
 
 
 
 return {'status':true,'value':t,'tropComplexe':true};
}
//=====================================================================================================================
function traiteCondition1(tab,ind,niveau,ch){
 var t='';
  
 // a priori, c'est une condition simple, dans la majorité des cas on a un " a < b " ou équivalent
 if( ch.indexOf('(')<0 && ch.indexOf(')')<0 && ch.indexOf('&&')<0  && ch.indexOf('||')<0 ){
  var tabCas=['<=','>=','<','>','!==','===','!=','=='];
  for(var i=0;i<=tabCas.length;i++){
   if(ch.indexOf(tabCas[i])>=0){
    var tt=ch.split(tabCas[i]);
    if(tt.length==2){

     var obja1=analyseChaineParElements1(tab,ind,niveau,tt[0]);
     var obja2=analyseChaineParElements1(tab,ind,niveau,tt[1]);
     
     if(obja1.status===true && obja2.status===true){
      if(tabCas[i]=='<'){
       t='inf('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }else if(tabCas[i]=='<='){
       t='infeg('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }else if(tabCas[i]=='>'){
       t='sup('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }else if(tabCas[i]=='>='){
       t='supeg('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }else if(tabCas[i]=='!=='){
       t='diffstricte('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }else if(tabCas[i]=='==='){
       t='egalstricte('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }else if(tabCas[i]=='!='){
       t='diff('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }else if(tabCas[i]=='=='){
       t='egal('+obja1.value.gauche.value+' , '+obja2.value.gauche.value+')'
      }
      return {status:true,value:t,'tropComplexe':false}
     }
    }
   }
  }
 }



// console.log('ch='+ch);
 var obj1=traiteConditionComplexe1(tab,ind,niveau,ch);
// console.log('obj1.value='+obj1.value)
 
 
 if(obj1.status==true){
  t=obj1.value;
  return {'status':true,'value':t,'tropComplexe':false};
 }else{
  return {'status':true,'value':t,'tropComplexe':true};
 }
 
 
 
}

//=====================================================================================================================
function traiteBoucleForVarIn1(tab,ind,niveau){

 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);

 var s=tab[ind][4].substr(5);
 s=s.replace(/\{/g,'');
 
// console.log('traite boucle s='+s);


 for(var i=s.length-1;i>=0;i--){
  var c=s.substr(i,1);
  if(c==')'){
   s=s.substr(0,i);
   break;
  }else if(c!=' '){
   s=s.substr(0,i+1);
  }
 }
 console.log('traite boucle s='+s);

 var tab=s.split(' in ');
 if(tab.length!=2){
  return logerreur({'status':false,'message':'Erreur dans un for(a in b), il y a des éléments en trop','line':tab[ind][5]});
 }

 var initialisationAvecUneDeclaration=false;
 var valeurInitialisationAvecUneDeclaration='';
 var variableDeclaree='';
 
 var initialisation=monTrim(tab[0]);
 if(initialisation.substr(0,3)=='var'){
  initialisationAvecUneDeclaration=true;
  variableDeclaree=initialisation.substr(3);
  valeurInitialisationAvecUneDeclaration='declare('+variableDeclaree+', obj())';
 }else{
  var objInit1=analyseChaineSimple1(tab,ind,niveau,initialisation,false);
  if(objInit1.status===false){
    return logerreur({'status':false,'message':'Erreur dans un for(a in b), l\'initialisation "'+initialisation+'" ne fonctionne pas','line':tab[ind][5]});
  }else{
   variableDeclaree=objInit1.value;
  }
 }

 var increment=monTrim(tab[1]);

 var valeurincrement='';
 var objIncr1=analyseChaineSimple1(tab,ind,niveau,increment,false);
 if(objIncr1.status==true){
   valeurincrement=objIncr1.value;
 }else{
  logerreur({'status':false,'message':'Erreur dans un for(a in b) 1, l\'incrément ne fonctionne pas','line':tab[ind][5]});
 }

 // boucleSurObjet(pourChaque(dans(a , b)),faire())
 
 if(initialisationAvecUneDeclaration){
  t+='\n'+valeurInitialisationAvecUneDeclaration+',';
 }
 t+='\n'+esp0+'boucleSurObjet(';
 t+='\n'+esp0+esp1+'pourChaque(dans('+variableDeclaree+' , '+valeurincrement+')),';
 t+='\n'+esp0+esp1+'faire(';
 
// t+='\n'+esp0+esp1+')';
// t+='\n'+esp0+')';
 return {'status':true,'value':t,'fermetureNiveau':2,'ajouterNiveauDedans':2};
 
 
 

}

//=====================================================================================================================
function traiteBoucleForClassique1(tab,ind,niveau){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 
// t+='\n'+' '.repeat(niveau*NBESPACESREV)+'#('+JSON.stringify(tab[ind])+'';
 
 
 var s=tab[ind][4].substr(5);
 s=s.replace(/\{/g,'');
 
 
 
// console.log('traite boucle s='+s);


 for(var i=s.length-1;i>=0;i--){
  var c=s.substr(i,1);
  if(c==')'){
   s=s.substr(0,i);
   break;
  }else if(c!=' '){
   s=s.substr(0,i+1);
  }
 }
// console.log('traite boucle s='+s);

 var tab=s.split(';');
 if(tab.length!=3){
  return logerreur({'status':false,'message':'Erreur dans un for, il y a des point-virgules en trop','line':tab[ind][5]});
 }
 
 
 var initialisation=tab[0];
 var objInit1=essayerDeclarationOuAffectationSimple1(tab,ind,niveau,initialisation);
 if(objInit1.status===false){
   return logerreur({'status':false,'message':'Erreur dans un for, l\'initialisation ne fonctionne pas','line':tab[ind][5]});
 }
 
 var valeurFinaleCondition='TODO ';
 var condition=tab[1];
 condition=monTrim(condition);
 var objCondition=traiteCondition1(tab,ind,niveau,condition);
 if(objCondition.status===true){
  if(objCondition.tropComplexe===false){
   valeurFinaleCondition=objCondition.value;
  }else{
   valeurFinaleCondition='TODO condition trop complexe ';
  }
 }else{
   return logerreur({'status':false,'message':'Erreur dans un for, la condition ne fonctionne pas','line':tab[ind][5]});
 }
// console.log('traite boucle condition="'+condition+'"');
 
 var increment=monTrim(tab[2]);
 
 var valeurincrement='';
 var objIncr1=analyseChaineSimple1(tab,ind,niveau,increment,false);
 if(objIncr1.status==true){
//  console.log('increment='+objIncr1.value);
  if(objIncr1.value.indexOf('++')>=0 || objIncr1.value.indexOf('--')>=0){
   if(objIncr1.value.indexOf('++')>0){
    var chaine1=increment.substr(0,objIncr1.value.indexOf('++'));
   }else if(objIncr1.value.indexOf('--')>0){
    var chaine1=increment.substr(0,objIncr1.value.indexOf('--'));
   }else{
    return logerreur({'status':false,'message':'Erreur dans un for 2, l\'incrément ne fonctionne pas : un ++i n\'est vraiment pas conseillé !','line':tab[ind][5]});
   }
   if(chaine1!=''){
    if(objIncr1.value.indexOf('--')>0){
     if(chaine1+'--'==objIncr1.value){
      valeurincrement='increment(affecte('+chaine1+' , '+chaine1+'-1)),';
     }else{
      return logerreur({'status':false,'message':'Erreur dans un for 3, l\'incrément ne fonctionne pas : un ++i n\'est vraiment pas conseillé !','line':tab[ind][5]});
     }
    }else{
     if(chaine1+'++'==objIncr1.value){
      valeurincrement='increment(affecte('+chaine1+' , '+chaine1+'+1)),';
     }else{
      return logerreur({'status':false,'message':'Erreur dans un for 4, l\'incrément ne fonctionne pas : un ++i n\'est vraiment pas conseillé !','line':tab[ind][5]});
     }
    }
   }
  }else{
   logerreur({'status':false,'message':'Erreur dans un for 5, l\'incrément ne fonctionne pas','line':tab[ind][5]});
  }
 }else{
 
  var objIncr1=essayerDeclarationOuAffectationSimple1(tab,ind,niveau,increment);
  if(objIncr1.status===false){
   logerreur({'status':false,'message':'Erreur dans un for 2, l\'incrément ne fonctionne pas','line':tab[ind][5]});
  }else{
   valeurincrement='increment(affecte('+objIncr1.value.gauche.value+' , '+objIncr1.value.droite.value+')),';
  }
 
 }
 
 
 if(objInit1.initialisationAvecUneDeclaration){
 t+='\n'+esp0+objInit1.value.value+',';
 }
 t+='\n'+esp0+'boucle(';
 t+='\n'+esp0+esp1+'initialisation(affecte('+objInit1.value.gauche.value+' , '+objInit1.value.droite.value+')),';
 t+='\n'+esp0+esp1+'condition(('+valeurFinaleCondition+')),';
 if(valeurincrement!=''){
  t+='\n'+esp0+esp1+valeurincrement;
 }else{
  t+='\n'+esp0+esp1+'increment(TODOaffecte(i , i+1)),';
 }
 t+='\n'+esp0+esp1+'faire(';
 
// t+='\n'+esp0+esp1+')';
// t+='\n'+esp0+')';
 return {'status':true,'value':t,'fermetureNiveau':2,'ajouterNiveauDedans':2};
}
//=====================================================================================================================
function traiteReturn11(tab,ind,niveau){

 var t='';
 var i=0;
 var ligne='';
 var type='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);

 ligne=monTrim(tab[ind][4]);
 ligne=ligne.replace(';','');
 
 console.log('ligne="'+ligne+'"');
 
 if(ligne=='return'){
  t+='\n'+esp0+'revenir()';
 }else{
  var quoi=monTrim(ligne.substr(6));
  var obj1=analyseChaineParElements1(tab,ind,niveau,quoi);
  if(obj1.status==true){
   t+='\n'+esp0+'revenir('+obj1.value.gauche.value+')';
  }
 }
 

 return {'status':true,'value':t,'fermetureNiveau':0,'ajouterNiveauDedans':0};

}

//=====================================================================================================================
function traiteTryCatch1(tab,ind,niveau){
 var t='';
 var i=0;
 var ligne='';
 var type='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var fermetureNiveau=0;
 var ajouterNiveauDedans=2;

//  }else if(ligne.substr(0,5)=='try {' || ligne.substr(0,9)== '} catch (' ){


 ligne=tab[ind][4];
 if(ligne.substr(0,5)=='try {'){
  type='try';
 }else{
  type='catch';
 }

 if(type=='try'){
  t+='\n'+esp0+'essayer(';
  t+='\n'+esp0+esp1+'faire(';
  fermetureNiveau=1;
 }else if(type=='catch'){
 
  var noMerreur='';
  console.log('dans catch, ligne=',ligne);
  monerreur=monTrim(ligne.substr(9).replace(')','').replace('{',''));
  console.log('dans catch, monerreur="'+monerreur+'"');
  
 
  t+='\n'+esp0+esp1+'sierreur(';
  t+='\n'+esp0+esp1+esp1+monerreur+' ,';
  t+='\n'+esp0+esp1+esp1+'faire(';
  fermetureNiveau=3;
  ajouterNiveauDedans=3;

 }
 return {'status':true,'value':t,'fermetureNiveau':fermetureNiveau,'ajouterNiveauDedans':ajouterNiveauDedans};

}

//=====================================================================================================================
function traiteIf1(tab,ind,niveau){
 var t='';
 var i=0;
 var ligne='';
 var type='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var fermetureNiveau=0;

// t+='\n'+' '.repeat(niveau*NBESPACESREV)+'#('+JSON.stringify(tab[ind])+'';
 
 ligne=tab[ind][4];

 if(ligne.substr(0,4)=='if (' || ligne.substr(0,11)=='} else if ('){

  if(ligne.substr(0,4)=='if ('){
   type='if'
   ligne=ligne.substr(4);
  }else{
   type='elseif'
   ligne=ligne.substr(11);
  }

  for(i=ligne.length-1;i>=0;i--){
   var c=ligne.substr(i,1);
   if(c==')'){
    ligne=ligne.substr(0,i);
    break;
   }else if(c!=' '){
    ligne=ligne.substr(0,i+1);
   }
  }
  
  var valeurFinaleCondition='TODO ';
  var condition=ligne;
  condition=monTrim(condition);
  var objCondition=traiteCondition1(tab,ind,niveau,condition);
  if(objCondition.status===true){
   if(objCondition.tropComplexe===false){
    valeurFinaleCondition=objCondition.value;
   }else{
    valeurFinaleCondition='TODO condition trop complexe ';
   }
  }else{
    return logerreur({'status':false,'message':'Erreur dans un for, la condition ne fonctionne pas','line':tab[ind][5]});
  }
  

 
 }else{
  type='else'
 }




 if(type=='if'){
  t+='\n'+esp0+'choix(';
  t+='\n'+esp0+esp1+'si(';
  t+='\n'+esp0+esp1+esp1+'condition(('+valeurFinaleCondition+')),';
  t+='\n'+esp0+esp1+esp1+'alors(';
  fermetureNiveau=2;
 }else if(type=='elseif'){
  t+='\n'+esp0+esp1+'sinonsi(';
  t+='\n'+esp0+esp1+esp1+'condition(('+valeurFinaleCondition+')),';
  t+='\n'+esp0+esp1+esp1+'alors(';
  fermetureNiveau=2;
 }else{
  t+='\n'+esp0+esp1+'sinon(';
  t+='\n'+esp0+esp1+esp1+'alors(';
  fermetureNiveau=3;
 }
 
  
 fermetureNiveau=3;
 if(type=='if'){
  // y a-t-il un else if ou un else
  for(i=ind+1;i<tab.length;i++){
   if(tab[i][1] < tab[ind][1]){
    break;
   }
   if(tab[i][1] == tab[ind][1]){
    if( tab[i][4].substr(0,11)=='} else if ('){
     fermetureNiveau=2;
     break;
    }else if( tab[i][4].substr(0,8)=='} else {'){
     fermetureNiveau=2;
     break;
    }else if( tab[i][4].substr(0,4)=='if (' || tab[i][4].substr(0,5)=='for (' || tab[i][4].substr(0,9)=='function ' || tab[i][4].substr(0,4)=='var ' ){
     
     fermetureNiveau=3;
     break;
    }else{
     
     fermetureNiveau=3;
     break;
    }
     
   }
  }
  
 }else if(type=='elseif'){
  for(i=ind+1;i<tab.length;i++){
   if(tab[i][1] < tab[ind][1]){
    break;
   }
   if(tab[i][1] == tab[ind][1]){
    if( tab[i][4].substr(0,8)=='} else {'){
     fermetureNiveau=2;
     break;
    }else if( tab[i][4].substr(0,4)=='if (' || tab[i][4].substr(0,5)=='for (' || tab[i][4].substr(0,9)=='function ' || tab[i][4].substr(0,4)=='var ' ){
     
     fermetureNiveau=3;
     break;
    }else{
     fermetureNiveau=3;
     break;
    }
     
   }
  }
 }else if(type=='else'){
  fermetureNiveau=3;
 }
  
 
 
 return {'status':true,'value':t,'fermetureNiveau':fermetureNiveau,'ajouterNiveauDedans':3};
}

//=====================================================================================================================
function monTrim(s){
 var t='';
 for(var i=0;i<s.length;i++){
  var c=s.substr(i,1);
  if(c==' '){
   t=s.substr(i+1);
  }else{
   t=s.substr(i);
   break;
  }
 }
 s=t;
 for(var i=s.length-1;i>=0;i--){
  var c=s.substr(i,1);
  if(c==' '){
   t=s.substr(0,i);
  }else if(c!=' '){
   break;
  }
 }
 return t; 
}
//=====================================================================================================================
function traiteDeclarationFonction1(tab,ind,niveau){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var lesArguments='';
 
 // function traiteCommentaire2(texte, niveau, ind) {
 var s=tab[ind][4].substr(9);
 var debutArguments=0;
 var nomFonction='';
 for(var i=0;i<s.length;i++){
  var c=s.substr(i,1);
  if(c=='('){
   debutArguments=i;
   break;
  }else{
   nomFonction+=c;
  }
 }
// console.log(s);
 var tabarg=[];
 s=s.substr(debutArguments);
 s=s.replace(/\(/g,'');
 s=s.replace(/\)/g,'');
 s=s.replace(/\{/g,'');
 s=monTrim(s);
 if(s!=''){
  tabarg=s.split(',');
  for(var i=0;i<tabarg.length;i++){
   lesArguments+='\n'+esp0+esp1+esp1+'argument('+tabarg[i].trim()+')';
   if(i!=tabarg.length-1){
    lesArguments+=',';
   }
  }
 }
 
 
 
 
 
// t+='\n'+esp0+'#('+JSON.stringify(tab[ind])+'';
 t+='\n'+esp0+'fonction(';
 t+='\n'+esp0+esp1+'definition(';
 t+='\n'+esp0+esp1+esp1+'nom('+nomFonction+')'+lesArguments;
 t+='\n'+esp0+esp1+'),';
 t+='\n'+esp0+esp1+'contenu(';

 return {'status':true,'value':t,'fermetureNiveau':2,'ajouterNiveauDedans':2};
}
//============================================================================================================
function essayerDeclarationOuAffectationSimple1(tab,ind,niveau,ligne){
 var objinit={};
 var initialisationAvecUneDeclaration=false;
 ligne=monTrim(ligne);
 if(ligne.substr(ligne.length-1,1)==';'){
  ligne=ligne.substr(0,ligne.length-1);
 }
 if(ligne.substr(0 , 4)=='var '){
  objinit=traiteDeclarationVariable1(tab,ind,niveau,ligne);
  if(objinit.status==true && objinit.gauche.isComplex==false && ( objinit.droite.isNum==true || objinit.droite.chaineQuotee==true || objinit.droite.isComplex==false ) ){
   initialisationAvecUneDeclaration=true;
  }else{
   return logerreur({'status':false,'message':'Erreur essayerDeclarationOuAffectationSimple1 la declaration "'+ligne+'" ne fonctionne pas','line':tab[ind][5]});
  }
 }else{
  objinit=traiteEgaliteSimple1(tab,ind,niveau,ligne);
  if(objinit.status==false){
    objinit=analyseChaineParElements1(tab,ind,niveau,ligne);
    if(objinit.status==false){
     return logerreur({'status':false,'message':'Erreur essayerDeclarationOuAffectationSimple1 la declaration ne fonctionne pas','line':tab[ind][5]});
    }else{
     return {'status':true,'value':objinit,'fermetureNiveau':false,'ajouterNiveauDedans':0,'initialisationAvecUneDeclaration':initialisationAvecUneDeclaration};
    }
  }else{
   return {'status':true,'value':objinit,'fermetureNiveau':false,'ajouterNiveauDedans':0,'initialisationAvecUneDeclaration':initialisationAvecUneDeclaration};
  }
 }
 return {'status':true,'value':objinit,'fermetureNiveau':false,'ajouterNiveauDedans':0,'initialisationAvecUneDeclaration':initialisationAvecUneDeclaration};
}
//=====================================================================================================================
function traiteLigne1(tab,ind,niveau){

 var esp0=' '.repeat(NBESPACESREV*niveau);

 var t='';
 var fermetureNiveau=0;
 var ajouterNiveauDedans=0;
// t+=JSON.stringify(tab[ind])+'\n';
// console.log('traiteLigne tab['+ind+']=',tab[ind])
 var ligne=monTrim(tab[ind][4]);
 if(ligne.substr(ligne.length-1,1)==';'){
  ligne=ligne.substr(0,ligne.length-1);
 }

 
 if(ligne.substr(0,4)=='var '){
 
  var obj=traiteDeclarationVariable1(tab,ind,niveau,'');
  if(obj.status===true){
   t+=obj.value;
  }else{
   temp={'status':false,'line':tab[ind][5],'message':'problème dans traiteLigne1 pour une déclatation de variable : ' + JSON.stringify(tab[ind])};
   return(logerreur(temp));
  }  

 }else if(ligne.substr(0,9)=='function '){
 
  var obj=traiteDeclarationFonction1(tab,ind,niveau);
  if(obj.status===true){
   t+=obj.value;
   fermetureNiveau=obj.fermetureNiveau;
   ajouterNiveauDedans=obj.ajouterNiveauDedans;
  }else{
   temp={'status':false,'line':tab[ind][5],'message':'problème dans traiteLigne1 pour une déclatation de variable : ' + JSON.stringify(tab[ind])};
   return(logerreur(temp));
  }  
 
 
 }else if(ligne.substr(0,5)=='for (' && ligne.indexOf(' in ')>0 ){
 
  var obj=traiteBoucleForVarIn1(tab,ind,niveau);
  if(obj.status===true){
   t+=obj.value;
   fermetureNiveau=obj.fermetureNiveau;
   ajouterNiveauDedans=obj.ajouterNiveauDedans;
  }else{
   temp={'status':false,'line':tab[ind][5],'message':'problème dans traiteLigne1 pour une boucle for(a in b)  : ' + JSON.stringify(tab[ind])};
   return(logerreur(temp));
  }  

 }else if(ligne.substr(0,5)=='for (' && ligne.indexOf(' in ')<0 ){
 
  var obj=traiteBoucleForClassique1(tab,ind,niveau);
  if(obj.status===true){
   t+=obj.value;
   fermetureNiveau=obj.fermetureNiveau;
   ajouterNiveauDedans=obj.ajouterNiveauDedans;
  }else{
   temp={'status':false,'line':tab[ind][5],'message':'problème dans traiteLigne1 pour une boucle for classique  : ' + JSON.stringify(tab[ind])};
   return(logerreur(temp));
  }  
 
 }else if(ligne.substr(0,5)=='try {' || ligne.substr(0,9)== '} catch (' ){

  var obj=traiteTryCatch1(tab,ind,niveau,'');
  if(obj.status===true){
   t+=obj.value;
   fermetureNiveau=obj.fermetureNiveau;
   ajouterNiveauDedans=obj.ajouterNiveauDedans;
  }else{
   temp={'status':false,'line':tab[ind][5],'message':'problème dans traiteLigne1 pour try catch : ' + JSON.stringify(tab[ind])};
   return(logerreur(temp));
  }
  
 }else if(ligne.substr(0,4)=='if (' || ligne.substr(0,11)=='} else if (' || ligne.substr(0,8)=='} else {'){
 
 
  var obj=traiteIf1(tab,ind,niveau);
  if(obj.status===true){
   t+=obj.value;
   fermetureNiveau=obj.fermetureNiveau;
   ajouterNiveauDedans=obj.ajouterNiveauDedans;
  }else{
   temp={'status':false,'line':tab[ind][5],'message':'problème dans traiteLigne1 pour une boucle : ' + JSON.stringify(tab[ind]) };
   return(logerreur(temp));
  }  
 
 
 }else if(ligne.substr(0,6)=='return'){
 
 
  var obj=traiteReturn11(tab,ind,niveau);
  if(obj.status===true){
     t+=obj.value;
     fermetureNiveau=obj.fermetureNiveau;
     ajouterNiveauDedans=obj.ajouterNiveauDedans;
  }else{
     temp={'status':false,'line':tab[ind][5],'message':'problème dans traiteLigne1 return : ' + JSON.stringify(tab[ind])};
     return(logerreur(temp));
  }  
 
 
 }else{
   var obj1=analyseChaineParElements1(tab,ind,niveau,ligne);
   if(obj1.status==true){
      if(obj1.value.droite!==null){
         if(obj1.value.droite.status===true){
            t+='\n'+' '.repeat(niveau*NBESPACESREV)+obj1.value.gauche.value+' '+obj1.value.droite.value;
         }else{
            t+='\n'+' '.repeat(niveau*NBESPACESREV)+'#('+JSON.stringify(tab[ind])+')';
            temp={'status':false,'line':tab[ind][5],'message':'traiteLigne1 : cas non prévu ATTENTION, le JS en entrée doir être formatté par closure : '+JSON.stringify(tab[ind])};
            console.log('',JSON.stringify(temp));
            logerreur(temp);
         }
      }else{
         if(obj1.value.gauche.parentEstFonction){
          fermetureNiveau+=3;
          ajouterNiveauDedans+=3;
         }
          
         t+='\n'+' '.repeat(niveau*NBESPACESREV)+obj1.value.gauche.value;
      }
   }else{
      t+='\n'+' '.repeat(niveau*NBESPACESREV)+'#('+JSON.stringify(tab[ind])+')';
      temp={'status':false,'line':tab[ind][5],'message':'traiteLigne1 : cas non prévu ATTENTION, le JS en entrée doir être formatté par closure : '+JSON.stringify(tab[ind])};
      console.log('',JSON.stringify(temp));
      logerreur(temp);
   }
 }
 return {'status':true,'value':t,'fermetureNiveau':fermetureNiveau,'ajouterNiveauDedans':ajouterNiveauDedans};
}
//=====================================================================================================================
function traiteArbre1(tab,idDebut,idParent,niveau){
 var t='';
 var esp1=' '.repeat(NBESPACESREV);
 
 for(var i=idDebut;i<tab.length;i++){
  if(tab[i][2]==idParent){
  
   var obj=traiteLigne1(tab,i,niveau);
   
   if(obj.status===true){
    t+=obj.value;
    if(tab[i][3]>0){ // si il a des enfants
     niveau=niveau+obj.ajouterNiveauDedans;
     var obj2=traiteArbre1(tab,i+1,tab[i][0],niveau);
     niveau=niveau-obj.ajouterNiveauDedans;
     if(obj2.status===true){
      t+=obj2.value;
      if(obj.fermetureNiveau>0){
       for( var j=obj.fermetureNiveau;j>0;j--){
        countNiveau=j;
        if(obj.fermetureNiveau==obj.ajouterNiveauDedans){
         countNiveau=j-1;
        }
        t+='\n'+' '.repeat(niveau*NBESPACESREV)+esp1.repeat(countNiveau)+')';
       }
      }
     }else{
      return logerreur({'status':false,'value':t,'message':'traite arbre erreur 0'});
     }
    }else{
     for( var j=obj.fermetureNiveau;j>0;j--){
      countNiveau=j;
      if(obj.fermetureNiveau==obj.ajouterNiveauDedans){
       countNiveau=j-1;
      }
      t+='\n'+' '.repeat(niveau*NBESPACESREV)+esp1.repeat(countNiveau)+')';
     }
    }
   }else{
    return logerreur({'status':false,'value':t,'message':'traite arbre erreur 1'});
   }
  }else if(tab[i][2]<tab[idDebut][2]){
//   console.log('PAS a traiter, on break',tab[i]);
   break;
  }else{
//   console.log(niveau+'RAAAAH ',tab[i]);
  }
 }
 return({'status':true,'value':t});
}


//=====================================================================================================================
function transformeSourceEnTableau1(sourceEntree){
  var lines = sourceEntree.split(/\r|\r\n|\n/);
  var inPop=false;
  for(var i=lines.length-1;i>=0;i--){
   
   if(lines[i].substr(0,2)=='*/'){
    inPop=true;
    lines.splice(i,1);
   }else if(lines[i].substr(0,2)=='/*'){
    inPop=false;
    lines.splice(i,1);
   }else{
    if(inPop){
     lines.splice(i,1);
    }
   }
  }   
   
  
  
  var l01=lines.length;
  var mainParentId=0;
  //             0        1         2          3       4        5
  var newTab=[['mainId','niveau','mainParId','nbEnf','init','numLigneOriginale']];
  var mainId=0;
  for(var i=0;i<l01;i++){
   if(lines[i]!=''){
    var s=lines[i];
    var min=0;
    var niveau=0;
    for(var j=0;j<s.length;j++){
     if(s.substr(j,1)!==' '){
      
      niveau=j/2;
      if(parseInt(niveau,10)*2!==niveau*2){
       return logerreur({'status':false,'message':'l\'indentation n\'est pas correcte'});
      }
      s=s.substr(j);
      break;
     }
    }
    if(!( s=='}' || s=='' || s.substr(0,2) == '//' || s.substr(0,12)=="'use strict'" || s.substr(0,12)=='"use strict"')){
     newTab.push([mainId,niveau,mainParentId,0,s,i]);
     mainId++
    }
   }
  }
    /*
      
      ==============================================================
      // mise à jour de l'id du parent[7] et du nombre d'éléments[8]
      ============================================================== 
    */
  l01=newTab.length;
  for(i=l01-1;i > 0;i=i-1){
      niveau=newTab[i][1];
      if(niveau==0){
          newTab[i][2]=-1;
      }else{
          for(j=i-1;j >= 0;j=j-1){
              if((newTab[j][1] == niveau-1)){
                  newTab[i][2]=newTab[j][0]; // idParent
                  newTab[j][3]=newTab[j][3]+1; // nombre d'enfants
                  break;
              }
          }
      }
  }
  
  console.log('transformeSourceEnTableau1 newTab=============================================\n',JSON.stringify(newTab).replace(/\],/g , '],\n'),'\n=============================\n');
  
  return({'status':true,'value':newTab});
  

}

//=====================================================================================================================
function transform(){
  //"àà"

  console.log('=========================\ndébut de transforme')
  document.getElementById('txtar2').value='';
  document.getElementById('resultat1').innerHTML='';
  clearMessages('zone_global_messages');
  var a=document.getElementById('txtar1');
  localStorage.setItem("fta_indexhtml_javascript_dernier_fichier_charge", a.value);
  
  var lines = a.value.split(/\r|\r\n|\n/);
  
  
  var count = lines.length;
  a.setAttribute('rows',count+1);
  
  var obj1=transformeSourceEnTableau1(a.value);
  if(obj1.status==true){
   newTab=obj1.value;
   var obj=traiteArbre1(newTab,1,-1,0);  
   console.log('\n\n\n===================\n\n\nretour parsing js ='+obj.status+'\n=====================\n'+obj.value);
   document.getElementById('resultat1').innerHTML='<pre>'+obj.value.replace(/&/g,'&amp;').replace(/</g,'&lt;')+'</pre>'; //  style="white-space: normal;"
   document.getElementById('txtar2').value=obj.value;
  }
  
  displayMessages('zone_global_messages');
  
  
  
 
}
//=====================================================================================================================
//=====================================================================================================================
//=====================================================================================================================
function chargerSourceDeTest(){
// debut de backtic ``` ci dessous pour la variable t = = = = = = = = = = = = = = = = = = = = = = = = = 
 var t=`/*
a.b("c").d += '<e f="g">' + h.i[i] + "</e>";

for (var i = 0; i < b; i++) {
  a.b("c").d += '<e>' + h.i[i] + "</e>";
}
t = " ".repeat(NBESPACESSOURCEPRODUIT * i);
t += " ".repeat(NBESPACESSOURCEPRODUIT * i);



//==========================================================================================
//testé
function traiteCommentaire2(texte, niveau, ind) {
  var s = "";
  s = traiteCommentaireSourceEtGenere1(texte, niveau, ind, NBESPACESSOURCEPRODUIT, false);
  return s;
}

function displayMessages() {
  for (var i = 0; i < global_messages.errors.length; i++) {
    document.getElementById("global_messages").innerHTML += '<div class="yyerror">' + global_messages.errors[i] + "</div>";
  }
  for (var i = 0; i < global_messages.lines.length; i++) {
    document.getElementById("global_messages").innerHTML += '<a href="javascript:jumpToError(' + (global_messages.lines[i] + 1) + ')" class="yyerror" style="border:2px red outset;">go to line ' + global_messages.lines[i] + "</a>&nbsp;";
  }
  var numLignePrecedente = -1;
  for (var i = 0; i < global_messages.ids.length; i++) {
    var id = global_messages.ids[i];
    if (id < global_messages.data.matrice.value.length) {
      var ligneMatrice = global_messages.data.matrice.value[id];
      var caractereDebut = ligneMatrice[5];
      var numeroDeLigne = 0;
      for (var j = caractereDebut; j >= 0; j--) {
        if (global_messages.data.tableau.out[j][0] == "\n") {
          numeroDeLigne++;
        }
      }
    }
    if (numeroDeLigne > 0) {
      if (numeroDeLigne != numLignePrecedente) {
        document.getElementById("global_messages").innerHTML += '<a href="javascript:jumpToError(' + (numeroDeLigne + 1) + ')" class="yyerror" style="border:2px red outset;">go to line ' + numeroDeLigne + "</a>&nbsp;";
        numLignePrecedente = numeroDeLigne;
      }
    }
  }
}

function espacesn(optionCRLF, i) {
  var t = "";
  if (optionCRLF) {
    t = "\r\n";
  } else {
    t = "\n";
  }
  if (i > 0) {
    t += " ".repeat(NBESPACESSOURCEPRODUIT * i);
  }
  return t;
}



*/`;




// fin de backtic ``` ci dessus pour la variable t = = = = = = = = = = = = = = = = = = = = = = = = = 
 dogid('txtar1').value=t;
}
//=====================================================================================================================
function chargerLeDernierSource(){
 var fta_indexhtml_javascript_dernier_fichier_charge=localStorage.getItem("fta_indexhtml_javascript_dernier_fichier_charge");
// console.log('fta_indexhtml_javascript_dernier_fichier_charge=' , fta_indexhtml_javascript_dernier_fichier_charge );
 if(fta_indexhtml_javascript_dernier_fichier_charge!==null){
  dogid('txtar1').value=fta_indexhtml_javascript_dernier_fichier_charge;
 }
}

chargerLeDernierSource();
transform();
</script>
  
</body></html>