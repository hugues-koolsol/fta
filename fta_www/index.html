<!DOCTYPE html>
<html lang="fr">
<head>
 <meta charset="utf-8" />
 <title>html home</title>
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <link rel="stylesheet" href="index.css" />
</head>
<body>
  <nav>
    <a href="index.html">html home</a>
    <a href="index.php">php home</a>
    <a href="todo.html">todo</a>
    <a href="funcToArray6.html">funcToArray6</a>
    <a href="aa_login.php">login</a>
  </nav>
  <h1>HTML HOME  🌞a&#11;a</h1>
  <ul class="menu2">
    <li><a href="javascript:chargerSourceDeTest()">source de test</a></li>
  </ul>
  <textarea class="txtar1" id="txtar1" rows="4"></textarea>
  <a href="javascript:transform()">transform</a>
  <div id="message1"></div>
  <div id="resultat1"></div>
  <script type="text/javascript" src="js/core4.js"></script>
<script type="text/javascript">
//=====================================================================================================================
function chargerSourceDeTest(){
 var t=`#( début aaaa  debut),
a(
  #(test , 👍),
  b(
    xx(
      y(
        #(dedans
          commentaire bloc
        ),
        t,
        v),
      #(aa),
      xx(
        #(dedans
          commentaire bloc
        )),
      #( bb),
      5,
      #(cc
      )
    ),
    #(comment 1),
    y(
      ' dd&nbsp;',
      #( bla
blu),
      ee,
      2,
      #( @ )
    ),
    #( comment 2 ),
    a(b())
  ),
  #(Iñtërnâtiônàà̀lizætiøn ☃ 💩 ❤ 😁 👍),
  ​f(​g​)​,
  #(👍😁💥💪👎☀🌞🟥🟩)
)`;
 dogid('txtar1').value=t;
}
//=====================================================================================================================
function chargerLeDernierSource(){
 var fta_indexhtml_dernier_fichier_charge=localStorage.getItem("fta_indexhtml_dernier_fichier_charge");
// console.log('fta_indexhtml_dernier_fichier_charge=' , fta_indexhtml_dernier_fichier_charge );
 if(fta_indexhtml_dernier_fichier_charge!==null){
  dogid('txtar1').value=fta_indexhtml_dernier_fichier_charge;
 }
}
//=====================================================================================================================


function transform(){
  //"àà"

  console.log('\n=========================\ndébut de transforme')
  document.getElementById('message1').innerHTML='';
  document.getElementById('resultat1').innerHTML='';

  var a=document.getElementById('txtar1');
  localStorage.setItem("fta_indexhtml_dernier_fichier_charge", a.value);
  
  
  
  var lines = a.value.split(/\r|\r\n|\n/);
  var count = lines.length;
  a.setAttribute('rows',count+1);
  
  
  
  var startMicro=performance.now();
  var tableau1=iterateCharacters2(a.value);
  var endMicro=performance.now();  console.log('mise en tableau endMicro=',parseInt(((endMicro-startMicro)*1000),10)/1000+' ms');
  console.log(a.value.substr(4,1),a.value.length)
/*
  var startMicro=performance.now();
  var tableau1=iterateCharacters(a.value);
  var endMicro=performance.now();  console.log('mise en tableau endMicro=',parseInt(((endMicro-startMicro)*1000),10)/1000+' ms');
*/  
/*
  if(tableau2.length==tableau1.length){
   var dif=false;
   console.log('👍 longueur tableaux Egaux');
   for(var i=0;i < tableau1.length ; i++){
    if(tableau2[i][0]!==tableau1[i][0]){
     console.error('\ntableau2['+i+']=',JSON.stringify(tableau2[i][0]),'\ntableau2['+i+']=',JSON.stringify(tableau2[i][0]));
     return;
    }
   }
  }
*/
 
//  console.log('tableau1.out=',tableau1.out);
  
  var startMicro=performance.now();
  var matriceFonction1=functionToArray2(tableau1.out);
  var endMicro=performance.now();  console.log('analyse syntaxique endMicro=',parseInt(((endMicro-startMicro)*1000),10)/1000+' ms');

//  console.log(matriceFonction1);
//  console.log(JSON.stringify(matriceFonction1.value));
  

  document.getElementById('message1').innerHTML='';
  document.getElementById('resultat1').innerHTML='';


  if(matriceFonction1.status===true){
  
  
    var parent=document.getElementById('resultat1');
    

    var startMicro=performance.now();
    var fonctionReecriteAvecRetour1=arrayToFunct1(matriceFonction1.value,true,false);
    var diResultatsCompactes=document.createElement('pre');
    
    if(fonctionReecriteAvecRetour1.status===true){
    
     var compacteOriginal=arrayToFunct1(matriceFonction1.value,false,false);
     
     
     var tableau2=iterateCharacters2(fonctionReecriteAvecRetour1.value);
     var matriceDeLaFonctionReecrite=functionToArray2(tableau2.out);
     var compacteReecrit=arrayToFunct1(matriceDeLaFonctionReecrite.value,false,false);
     
     if(compacteOriginal.status==true && compacteReecrit.status===true){
      if(compacteOriginal.value == compacteReecrit.value){
       diResultatsCompactes.innerHTML=diResultatsCompactes.innerHTML+'<hr /><b style="color:green;">👍 sources compactés Egaux</b>';
      }else{
       diResultatsCompactes.innerHTML=diResultatsCompactes.innerHTML+'<hr /><b style="color:red;">💥sources compactés différents</b>';
       diResultatsCompactes.innerHTML=diResultatsCompactes.innerHTML+'<br />o='+compacteOriginal.value;
       diResultatsCompactes.innerHTML=diResultatsCompactes.innerHTML+'<br />r='+compacteReecrit.value;
      }
     
     }else{
      diResultatsCompactes.innerHTML=diResultatsCompactes.innerHTML+'<hr /><b style="color:red;">compacteOriginal='+JSON.stringify(compacteOriginal)+'</b>';
      diResultatsCompactes.innerHTML=diResultatsCompactes.innerHTML+'<br /><b style="color:red;">compacteReecrit='+JSON.stringify(compacteReecrit)+'</b>';
     }
     
    }
    var endMicro=performance.now();  console.log('tests compactes=',parseInt(((endMicro-startMicro)*1000),10)/1000+' ms');
    
    document.getElementById('resultat1').appendChild(diResultatsCompactes);
    
    
    
    var fonctionReecriteAvecEtColoration1=arrayToFunct1(matriceFonction1.value,true,true);
    var difonctionReecriteAvecRetour1=document.createElement('pre');
    if(fonctionReecriteAvecEtColoration1.status===true){
     difonctionReecriteAvecRetour1.innerHTML='<hr  />arrayToFunctNoComment2:<hr />'+fonctionReecriteAvecEtColoration1.value;
    }else{
     difonctionReecriteAvecRetour1.innerHTML='<hr />💥arrayToFunctNoComment2:'+fonctionReecriteAvecRetour1.message;
    }
    document.getElementById('resultat1').appendChild(difonctionReecriteAvecRetour1);
    
    
    
    
    
    
    
    var t1=document.createElement('table');
    t1.setAttribute('class','tableau1');
    ConstruitHtmlMatrice(t1,matriceFonction1);
    document.getElementById('resultat1').appendChild(t1);
/*    
    var t1=document.createElement('table');
    t1.setAttribute('class','tableau1');
    ConstruitHtmlMatrice(t1,matriceFonction2);
    document.getElementById('resultat1').appendChild(t1);
*/    
    
/*    
    var startMicro=performance.now();
    var matriceFonction1=functionToArray2(tableau1.out);
    var endMicro=performance.now();  console.log('analyse syntaxique endMicro=',parseInt(((endMicro-startMicro)*1000),10)/1000+' ms');
    var told1=document.createElement('table');
    told1.setAttribute('class','tableau1');
    
    ConstruitHtmlMatrice(told1,matriceFonction1);
    document.getElementById('resultat1').appendChild(told1);
*/
//    console.log('\nmatriceFonction1='+JSON.stringify(matriceFonction1.value))
    
    
    var t2=document.createElement('table');
    
    ConstruitHtmlTableauCaracteres(t2,a.value,tableau1)
    document.getElementById('resultat1').appendChild(t2);
    
    
    
  
  }else{
    var sp1=document.createElement('span');
    sp1.style.color='red';
    sp1.innerHTML=matriceFonction1.message;
    document.getElementById('resultat1').appendChild(sp1);
    
    var t2=document.createElement('table');
    
    ConstruitHtmlTableauCaracteres( t2 , a.value , tableau1 );
    document.getElementById('resultat1').appendChild(t2);
    
    
  }

  
 
}

chargerLeDernierSource();
transform();
</script>
  
</body></html>