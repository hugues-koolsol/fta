<!DOCTYPE html>
<html lang="fr">
<head>
 <meta charset="utf-8" />
 <title>html home</title>
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <link rel="stylesheet" href="index.css" />
</head>
<body>
  <nav>
    <a href="index.html">html home</a>
    <a href="index.php">php home</a>
    <a href="todo.html">todo</a>
    <a href="traiteJs.html">traiteJs</a>
    <a href="aa_login.php">login</a>
  </nav>
  <h1>traiteJs</h1>
  <ul class="menu2">
    <li><a href="javascript:chargerSourceDeTest()">source de test</a></li>
  </ul>
  
  <!-- label>Nom du fichier Js<input name="NomDuJs" id="NomDuJs" value="" style="border: 1px lightgrey inset;" /></label -->
  <div id="zone_global_messages"></div>
  <br />
  <textarea class="txtar1" id="txtar1" rows="4"></textarea>
  <a href="javascript:transform()">transform</a>
  
  <div id="resultat1"></div>
  
  <textarea class="txtar1" id="txtar2" rows="4"></textarea>
  
  
  <script type="text/javascript" src="js/core4.js"></script>
  <script type="text/javascript" src="js/compile1.js"></script>
  <script type="text/javascript" src="js/javascript.js"></script>
  <!-- https://esprima.org/doc/videos.html -->
  <script type="text/javascript" src="esprima.js"></script>
<script type="text/javascript">

var a='hugues';
console.log(replaceAll(a,'u','toto'))
'use strict';
//=========================================================================================================
function recupNomOperateur(s){ // recupNomOperateur
 if(s==='typeof'){
  return 'Typeof';
 }else if(s==='instanceof'){
  return 'Instanceof';
 }else if(s==='++'){
  return 'incr1';
 }else if(s==='--'){
  return 'decr1';
 }else if(s==='+'){
  return 'plus';
 }else if(s==='-'){
  return 'moins';
 }else if(s==='*'){
  return 'mult';
 }else if(s==='/'){
  return 'divi';
 }else if(s==='=='){
  return 'egal';
 }else if(s==='==='){
  return 'egalstricte';  
 }else if(s==='!='){
  return 'diff';
 }else if(s==='!=='){
  return 'diffstricte';
 }else if(s==='>'){
  return 'sup';
 }else if(s==='<'){
  return 'inf';
 }else if(s==='>='){
  return 'supeg';
 }else if(s==='<='){
  return 'infeg';
 }else if(s==='!'){
  return 'non';
 }else if(s==='&&'){
  return 'et';
 }else if(s==='||'){
  return 'ou';
 }else if(s==='&'){
  return 'etBin';
 }else{
  return 'TODO recupNomOperateur pour "'+s+'"'
 }
}
//=========================================================================================================
function traiteBinaryExpress1(element,niveau,parentEstCrochet){
 var t='';
 
 
 if(element.left && element.left.type==='Identifier'){
 
  var nomDuTest=recupNomOperateur(element.operator);
  if(element.right && element.right.type==='Identifier'){
   if(parentEstCrochet && (nomDuTest==='plus' || nomDuTest==='moins' ) ){
    t+=''+element.left.name+element.operator+element.right.name+'';
   }else{
    t+=''+nomDuTest+'('+element.left.name+','+element.right.name+')';
   }
  }else if(element.right && element.right.type==='Literal'){
   if(parentEstCrochet && (nomDuTest==='plus' || nomDuTest==='moins' ) ){
    t+=''+element.left.name+element.operator+element.right.raw+'';
   }else{
    t+=''+nomDuTest+'('+element.left.name+','+element.right.raw+')';
   }
  }else if(element.right && element.right.type==='BinaryExpression'){
   var obj1=traiteBinaryExpress1(element.right,niveau,parentEstCrochet);
   if(obj1.status===true){
    t+=''+nomDuTest+'('+element.left.name+','+obj1.value+')';
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 94 '});
   }
  }else if(element.right && element.right.type==='MemberExpression'){
   var obj1=traiteMemberExpression1(element.right,niveau,element,'');
   if(obj1.status===true){
    t+=''+nomDuTest+'('+element.left.name+','+obj1.value+')';
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 99 '});
   }
  }else if(element.right && element.right.type==="UnaryExpression"){
   var nomDuTestUnary=recupNomOperateur(element.right.operator);
   if(element.left && element.left.type==='Identifier' && element.right.argument.type==='Literal'){
    if(nomDuTestUnary==='plus' || nomDuTestUnary==='moins'){
     t+=''+nomDuTest+'('+element.left.name+' , '+element.right.operator+element.right.argument.raw+')';
    }else{
     t+=''+nomDuTest+'('+element.left.name+' , '+nomDuTestUnary+'('+element.right.argument.raw+')'+')';
    }
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 119 '});
   }
   
  }else{
   console.error('traiteBinaryExpress1 todo 61 ',element );
  }
  
 }else if(element.left && element.left.type=='Literal'){
 
  if(element.right && element.right.type==='Literal'){
   var nomDuTest=recupNomOperateur(element.operator);
   t+=''+nomDuTest+'('+element.left.raw+','+element.right.raw+')';
  }else if(element.right && element.right.type==='MemberExpression'){
   var nomDuTest=recupNomOperateur(element.operator);
   var obj1=traiteMemberExpression1(element.right,niveau,element,'');
   if(obj1.status===true){
    t+=''+nomDuTest+'('+element.left.raw+','+obj1.value+')';
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 99 '});
   }
  
  }else if(element.right && element.right.type==='BinaryExpression'){
  
   var nomDuTest=recupNomOperateur(element.operator);
   var obj1=traiteBinaryExpress1(element.right,niveau,parentEstCrochet);
   if(obj1.status===true){
    t+=''+nomDuTest+'('+element.left.raw+','+obj1.value+')';
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 94 '});
   }
   
  }else if(element.right && element.right.type==='Identifier'){
  
   var nomDuTest=recupNomOperateur(element.operator);
   t+=''+nomDuTest+'('+element.left.raw+','+element.right.name+')';
   
  }else if(element.right && element.right.type==='CallExpression'){
   var nomDuTest=recupNomOperateur(element.operator);
   var obj1=traiteCallExpression1(element.right,niveau,element,{});
   if(obj1.status===true){
    t+=''+nomDuTest+'('+element.left.raw+','+obj1.value+')';
   }else{
    console.error('erreur traiteMemberExpression1 element=',element)
    return logerreur({status:false,message:'erreur traiteMemberExpression1 237 pour '+element.object.type })
   }
  
  }else{
  
   console.error('traiteBinaryExpress1 todo  64 ',element.right.type );
   
  }

 }else if(element.left && element.left.type=="BinaryExpression"){
 
  var nomDuTest=recupNomOperateur(element.operator);
  
  var obj0=traiteBinaryExpress1(element.left,niveau,parentEstCrochet);
  if(obj0.status===true){
   
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 128 '});
  }
  
  if(element.right && element.right.type==='Identifier'){
   t+=nomDuTest+'('+obj0.value+' , '+element.right.name + ')';
  }else if(element.right && element.right.type==='Literal'){
   t+=nomDuTest+'('+obj0.value+','+element.right.raw+')';
  }else if(element.right && element.right.type==='MemberExpression'){
   var obj1=traiteMemberExpression1(element.right,niveau,element,'');
   if(obj1.status===true){
    t+=nomDuTest+'('+obj0.value+','+obj1.value+')';
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 140 '});
   }
   
  }else{
   console.error('traiteBinaryExpress1 todo 110 ',element );
  }


 }else if(element.left && element.left.type=="MemberExpression"){
  var nomDuTest=recupNomOperateur(element.operator);
  var obj1=traiteMemberExpression1(element.left,niveau,element,'');
  if(obj1.status===true){
   if(element.right && element.right.type==='Literal'){
    if(parentEstCrochet && (nomDuTest==='plus' || nomDuTest==='moins' ) ){
     t+=obj1.value+element.operator+element.right.raw;
    }else{
     t+=''+nomDuTest+'('+obj1.value+','+element.right.raw+')';
    }
   
   
   }else if(element.right && element.right.type==='Identifier'){
    if(parentEstCrochet && (nomDuTest==='plus' || nomDuTest==='moins' ) ){
     t+=obj1.value+element.operator+element.right.name;
    }else{
     t+=''+nomDuTest+'('+obj1.value+','+element.right.name+')';
    }
   }else if(element.right && element.right.type==="MemberExpression"){
    var obj2=traiteMemberExpression1(element.right,niveau,element,'');
    if(obj2.status===true){
     t+=''+nomDuTest+'('+obj1.value+','+obj2.value+')';
    }else{
     return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 193 '});
    }
   }else if(element.right && element.right.type==="BinaryExpression"){

    var obj2=traiteBinaryExpress1(element.right,niveau,parentEstCrochet);
    if(obj2.status===true){
     
     t+=''+nomDuTest+'('+obj1.value+','+obj2.value+')';
     
    }else{
     return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 94 '});
    }
    
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 173 '+element.right.type});
   }
  
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 148 '});
  }
  
  
 }else if(element.left && element.left.type=="UnaryExpression"){
  var nomDuTestUnary=recupNomOperateur(element.left.operator);
  var nomDuTest=recupNomOperateur(element.operator);
  if(element.right && element.right.type==='Literal' && element.left.argument.type==='Identifier'){
   t+=''+nomDuTest+'('+nomDuTestUnary+'('+element.left.argument.name+')'+','+element.right.raw+')';
  }else if(element.right && element.right.type==='Literal' && element.left.argument.type==="MemberExpression"){
   var obj1=traiteMemberExpression1(element.left.argument,niveau,element.left,'');
   if(obj1.status===true){
    t+=''+nomDuTest+'('+nomDuTestUnary+'('+obj1.value+')'+','+element.right.raw+')';
   }else{
    return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 0240 '});
   }
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 0243 '});
  }
  
 }else if(element && element.type=="MemberExpression"){
  
  var obj1=traiteMemberExpression1(element,niveau,element,'');
  if(obj1.status===true){
   t+='TODO 216';
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteBinaryExpress1 217 '});
  }
  
  
  
  
 }else{
 
  console.error('traiteBinaryExpress1 todo 66 ',element );
  
 }
 
 return {status:true,value:t}
}
//=========================================================================================================
function traiteLogicalExpression1(element , niveau){
 var t='';

 if(element.left && element.right){
  var obj1=traiteCondition1(element.left,niveau);
  if(obj1.status===true){
   t+=''+obj1.value+'';
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteLogicalExpression1 0274 '});
  }
  if("&&"==element.operator){
   t+=',et'
  }else if("||"==element.operator){
   t+=',ou'
  }else{
   console.error('traiteLogicalExpression1 todo 80 ',element.operator );
  }
  var obj2=traiteCondition1(element.right,niveau);
//   console.log('ici' + element.right.type)
  if(obj2.status===true){
   if(element.right.type=='LogicalExpression'){
    t+='('+obj2.value+')';
   }else if(element.right.type=='BinaryExpression'){
    t+=''+obj2.value+'';
   }else if(element.right.type=='MemberExpression'){
    var obj3=traiteMemberExpression1(element.right,niveau,element,'');
    if(obj3.status===true){
     t+='('+obj3.value+')';
    }else{
     return logerreur({'status':false,'message':'erreur dans traiteLogicalExpression1 0295 '});
    }
   }else if(element.right.type=='UnaryExpression'){
    if(element.right.argument.type==="CallExpression"){
     var nomDuTestUnaryRight=recupNomOperateur(element.right.operator);
     var obj1=traiteCallExpression1(element.right.argument,niveau,element.right,{'sansLF':true});
     if(obj1.status===true){
      if(element.left.argument.type==="CallExpression"){
       var nomDuTestUnaryLeft=recupNomOperateur(element.left.operator);
       var obj2=traiteCallExpression1(element.left.argument,niveau,element.left,{'sansLF':true});
       if(obj2.status===true){
        t=nomDuTestUnaryLeft+'('+obj2.value+')'+t+'('+nomDuTestUnaryRight+'('+obj1.value+'))';
       }else{
        return logerreur({status:false,message:'erreur traiteLogicalExpression1 326 ' })
       }
      }else{
        return logerreur({status:false,message:'erreur traiteLogicalExpression1 326 ' })
      }
     }else{
      return logerreur({status:false,message:'erreur traiteLogicalExpression1 326 ' })
     }
    }else{
      return logerreur({status:false,message:'erreur traiteLogicalExpression1 326 ' })
    }
   }else if(element.right.type=='Identifier'){
    t+='('+element.right.name+')';
   }else{
    console.error('traiteLogicalExpression1 todo 0102 ',element.right.type );
    return logerreur({'status':false,'message':'erreur dans traiteLogicalExpression1 0292 '+element.right.type});
   }
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteLogicalExpression1 0234 '});
  }
 }else{
  console.error('traiteLogicalExpression1 todo 72 ',element );
  return logerreur({'status':false,'message':'erreur dans traiteLogicalExpression1 0238 '});
 }
 
 return {status:true,value:t}
}
//=========================================================================================================
function traiteCondition1(element,niveau){
 var t='';
// console.warn('element=',element);
 if(element.type==='BinaryExpression'){
  var obj1=traiteBinaryExpress1(element,niveau,false);
  if(obj1.status===true){
   t+='('+obj1.value+')';
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteCondition1 0265 '});
  }
  
 }else if(element.type==='LogicalExpression'){
  var obj=traiteLogicalExpression1(element,niveau);
  if(obj.status===true){
   t+=''+obj.value+'';
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteCondition1 0272 '});
  }
 }else if(element.type==='Identifier'){
  t+='('+element.name+')'; // egalstricte(
 }else if(element.type==='MemberExpression'){

  var obj1=traiteMemberExpression1(element,niveau,element,'');
  if(obj1.status===true){
   t+='('+obj1.value+')'; // egalstricte(
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteCondition1 0318 '});
  }
 }else if(element.type==="CallExpression"){
  var obj1=traiteCallExpression1(element,niveau,element,{'sansLF':true});
  if(obj1.status===true){
   t+='('+obj1.value+')';
  }else{
   return logerreur({status:false,message:'erreur traiteCondition1 326 ' })
  }
  
 }else if(element.type==="UnaryExpression"){
  
  var nomDuTestUnary=recupNomOperateur(element.operator);
  if(element.operator==='!' && element.argument.type==='LogicalExpression'){
   
   var obj1=traiteLogicalExpression1(element.argument,niveau);
   if(obj1.status===true){
    t+=nomDuTestUnary+'('+obj1.value+')';
    
   }else{
    return logerreur({status:false,message:'erreur dans traiteAssignmentExpress1 1181' })
   }
  }else if(element.operator==='!' && element.argument.type==='Identifier'){
    t+=nomDuTestUnary+'('+element.argument.name+')';

  }else if(element.operator==='!' && element.argument.type==='CallExpression'){

   var obj1=traiteCallExpression1(element.argument,niveau,element,{'sansLF':true});
   if(obj1.status===true){
    t+=nomDuTestUnary+'('+element.argument.name+')';
   }else{
    return logerreur({status:false,message:'erreur traiteCondition1 0421 ' })
   }

  }else{

   console.error('traiteCondition1 todo 305 ',element.operator );
   return logerreur({'status':false,'message':'erreur dans traiteCondition1 0414 '+element.operator + ' ' + element.argument.type });
  }
 
 
  
 }else{
  console.error('traiteCondition1 todo 305 ',element );
  return logerreur({'status':false,'message':'erreur dans traiteCondition1 0420 '});
 }
 return {status:true,value:t}
}
//=========================================================================================================
function traiteForIn1(element , niveau){
 console.log('%c dans traiteForIn1, element=' , "color:green;font-weight:bold;background:yellow;" , element);
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var nomVariable='';
 var nomObjet='';

 var pourInit='';
 if(element.left.type==="VariableDeclaration"){
  var objDecl=traiteDeclaration1(element.left,niveau);
  if(objDecl.status===true){
  
   t+='declare('+objDecl.nomVariable+' , obj() ),';
   nomVariable=objDecl.nomVariable;
  }else{
   return logerreur({status:false,message:'erreur pour traiteForIn1 0351 '+element.left.type })
  }
  
 }else if(element.left.type==="Identifier"){
 
  nomVariable=element.left.name;
  
 }else if(element.left.type==="MemberExpression"){
 
  var obj1=traiteMemberExpression1(element.left,niveau,element,'');
  if(obj1.status===true){
   nomVariable=obj1.value;
   
  }else{
   return logerreur({'status':false,'message':'erreur dans traiteCondition1 0318 '});
  }
  
 }else{
 
  console.log('element.left.type=' , element.left.type)
  return logerreur({status:false,message:'erreur pour traiteForIn1 0414 '+element.left.type })
  
 }
 
 if(element.right.type==='Identifier'){
 
  nomObjet=element.right.name;
  
 }else if(element.right.type==="MemberExpression"){
 
  var obj1=traiteMemberExpression1(element.right,niveau,element,'');
  if(obj1.status===true){
   nomObjet=obj1.value;

  }else{
   return logerreur({'status':false,'message':'erreur dans traiteCondition1 0318 '});
  }
  
 }else{
  return logerreur({status:false,message:'erreur pour traiteForIn1 0421 '+element.right.type })
 }
 
 
 t+='\n'+esp0+'boucleSurObjet(';
 t+='\n'+esp0+esp1+'pourChaque(dans('+nomVariable+' , '+nomObjet+')),';
 
 t+='\n'+esp0+esp1+'faire(';
 niveau+=1;
 if(element.body){
  var obj3=TransformAstEnRev(element.body,niveau);
 }
 niveau-=1;
 if(obj3.status===true){
  t+=obj3.value;
 }else{
  return logerreur({status:false,message:'erreur traiteFor1 152 pour '+element.type })
 }
 
 t+='\n'+esp0+esp1+')'; // fin faire

 t+='\n'+esp0+')'; // fin boucleSurObjet


 return {status:true,value:t}
}
//=========================================================================================================
function traiteFor1(element , niveau){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);

 console.log('%c dans traiteFor1, element=' , "color:green;font-weight:bold;background:yellow;" , element);

 var pourInit='';
 if(element.init.type==="VariableDeclaration"){
  var objDecl=traiteDeclaration1(element.init,niveau);
  if(objDecl.status===true){
  
   t+=objDecl.value;
   
   if(pourInit!=''){
    pourInit+=',';
   }
   pourInit+=objDecl.value.replace(/declare/g,'affecte').replace(/\n/g,'');
  }else{
   return logerreur({status:false,message:'erreur pour traiteFor1 134 '+element.init.type })
  }
 }else if('SequenceExpression' == element.init.type){
 
  for(var i=0;i<element.init.expressions.length;i++){
   niveau+=2;
   var obj1=traiteAssignmentExpress1(element.init.expressions[i] , niveau , {'sansLF':true});
   niveau-=2;
   
   if(obj1.status===true){
   
    if(pourInit!=''){
     pourInit+=',';
    }
    pourInit+=obj1.value;
    
   }else{
   
    return logerreur({status:false,message:'erreur traiteFor1 213 pour '+element.type })
    
   }
   
   console.log(element.init.expressions[i]);
   
  }
 }else if('AssignmentExpression' == element.init.type){
  
  var objass0=traiteAssignmentExpress1(element.init,niveau,{'sansLF':true});
  if(objass0.status===true){
   pourInit=objass0.value;
  }else{
   return logerreur({status:false,message:'erreur traiteFor1 248 pour '+element.type });
  }
 
 
 }else{
  console.log('element.init.type=' , element.init.type)
 }

 t+='\n'+esp0+'boucle(';
 t+='\n'+esp0+esp1+'initialisation(';
 if(pourInit!=''){
  t+=pourInit;
 }else{
  t+='TODO';
 }
 t+=')';
 t+='\n'+esp0+esp1+'condition(';
 var obj2=traiteCondition1(element.test,0);
 if(obj2.status===true){
  t+=''+obj2.value;
 }else{
  return logerreur({status:false,message:'erreur traiteFor1 238 pour '+element.type })
 }
 
 t+=')';
 t+='\n'+esp0+esp1+'increment(';
 if(element.update.type==="AssignmentExpression"){
  var objass=traiteAssignmentExpress1(element.update,niveau,{'sansLF':true});
  if(objass.status===true){
   t+=objass.value+')';
  }else{
   return logerreur({status:false,message:'erreur traiteFor1 248 pour '+element.type });
  }
 }else if(element.update.type==="UpdateExpression"){
  var objass=traiteUpdateExpress1(element.update,niveau,{'sansLF':true});
  if(objass.status===true){
   t+=objass.value+')';
  }else{
   return logerreur({status:false,message:'erreur traiteFor1 248 pour '+element.type });
  }
 }else{
  t+='TODO)';
 }
 
 
 t+='\n'+esp0+esp1+'faire(';
 niveau+=1;
 if(element.body){
  var obj3=TransformAstEnRev(element.body,niveau);
 }
 niveau-=1;
 if(obj3.status===true){
  t+=obj3.value;
 }else{
  return logerreur({status:false,message:'erreur traiteFor1 152 pour '+element.type })
 }
 
 t+='\n'+esp0+esp1+')'; // fin faire

 t+='\n'+esp0+')'; // fin boucle
 


 return {status:true,value:t}

}
//=========================================================================================================
function traiteIf1(element , niveau ,type ){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 
 if(t!==''){
  t+=',';
 }
 if(type=='if'){
  t+='\n'+esp0+'choix(';
  t+='\n'+esp0+esp1+'si(';
  t+='\n'+esp0+esp1+esp1+'condition(';
  var obj2=traiteCondition1(element.test,0);
  if(obj2.status===true){
   t+=''+obj2.value;
  }else{
   return logerreur({status:false,message:'erreur traiteIf1 135 pour '+element.type })
  }
  t+='),';
 }else{
  if(element.test){ // c'est un elseif
   t+='\n'+esp0+esp1+'sinonsi(';
   t+='\n'+esp0+esp1+esp1+'condition(';
   var obj2=traiteCondition1(element.test,0);
   if(obj2.status===true){
    t+=''+obj2.value;
   }else{
    return logerreur({status:false,message:'erreur traiteIf1 372 pour '+element.type })
   }
   t+='),';
  }else{ // c'est un else
   t+='\n'+esp0+esp1+'sinon(';
  }
 }
 t+='\n'+esp0+esp1+esp1+'alors(';
 niveau+=3;
 if(element.consequent){
  var obj3=TransformAstEnRev(element.consequent.body,niveau);
 }else{
  var obj3=TransformAstEnRev(element.body,niveau);
 }
 niveau-=3;
 if(obj3.status===true){
  t+='\n'+esp0+esp1+esp1+esp1+obj3.value;
 }else{
  return logerreur({status:false,message:'erreur traiteIf1 160 pour '+element.type })
 }
 t+='\n'+esp0+esp1+esp1+')'; // fin alors
 t+='\n'+esp0+esp1+')'; // fin si
 // y a-t-il des alternates
 if(element.alternate){
  var obj3=traiteIf1(element.alternate,niveau,'else');
  if(obj3.status===true){
   t+=obj3.value;
  }else{
    return logerreur({status:false,message:'erreur traiteIf1 170 pour '+element.type })
  }
 }
 
 if(type=='if'){
  t+='\n'+esp0+')';
 }
     
 
 return {status:true,value:t}
}

//=========================================================================================================
function traiteCallExpression1(element , niveau , parent , opt , cumulProprieteMembre ){
 console.log('%c dans traiteCallExpression1 element=','color:red;background:yellow;font-weight:bold;',element,'parent=',parent);
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var LF='\n';

 var parentProperty=''; 
 if(parent.property){
  if(parent.property.type==="Identifier"){
   parentProperty='prop('+parent.property.name+cumulProprieteMembre+')';
   cumulProprieteMembre='';
  }else{
   return logerreur({status:false,message:'erreur dans traiteCallExpression1 0514' });
  }
 }
 
 
 
 if(opt['sansLF']){
  LF='';
  esp0='';
  esp1='';
 }
 var transformeEnReplaceAll='';
 var transformeEnReplace='';
 
 
 
 
 
 console.log( 'element=',element);
 
 var lesArguments='';
 if(element.arguments && element.arguments.length>0){
  for(var i=0;i<element.arguments.length;i++){
   lesArguments+=',';
   if("Literal"===element.arguments[i].type){
    if(transformeEnReplaceAll!==''){
     if(element.arguments[i].raw.substr(0,1)=='/' && element.arguments[i].raw.substr(element.arguments[i].raw.length-1,1)=='g' ){
      t+=transformeEnReplaceAll;
      var leParam=replaceAll(element.arguments[i].raw,'\\\\','\\\\');
      leParam=leParam.substr(1,leParam.length-2);
      leParam='\''+leParam+'\'';
      lesArguments+=',p('+leParam+')';
      
     }else{
      t+=transformeEnReplace;
      lesArguments+=',p('+element.arguments[i].raw+')';
     }
     transformeEnReplaceAll='';
    }else{
     lesArguments+='p('+element.arguments[i].raw+')';
    }
   }else if("Identifier"===element.arguments[i].type){
    lesArguments+='p('+element.arguments[i].name+')';
   }else if("BinaryExpression"===element.arguments[i].type){
    obj1=traiteBinaryExpress1(element.arguments[i],niveau,true)
    if(obj1.status===true){
     lesArguments+='p('+obj1.value+')';
     console.log('%c 717 vérifier la validite de ', 'color:yellow;background:red;' , 'p('+obj1.value+')');
    }else{
     return logerreur({status:false,message:'erreur traiteCallExpression1 452 ' });
    }
   
   }else if("CallExpression"===element.arguments[i].type){
    var obj1=traiteCallExpression1(element.arguments[i],niveau,element,{'sansLF':true});
    if(obj1.status===true){
     if(obj1.value.substr(0,6)==='appelf'){
      lesArguments+='p('+obj1.value+')';
     }else{
      lesArguments+='p(appelf('+obj1.value+'))';
     }
    }else{
     console.error('Dans traiteCallExpression1 element=',element)
     return logerreur({status:false,message:'erreur traiteCallExpression1 479 ' })
    }
   }else if("MemberExpression"===element.arguments[i].type){
    var obj1=traiteMemberExpression1(element.arguments[i],niveau,element,'');
    if(obj1.status===true){
     lesArguments+='p('+obj1.value+')';
    }else{
     return logerreur({status:false,message:'erreur dans traiteCallExpression1 485 ' })
    }
   
   }else{
    lesArguments+='p( TODO dans traiteCallExpression1 pour 483 '+element.arguments[i].type+')';
   }
  }
 }
 if(lesArguments===''){
  lesArguments=parentProperty;
 }else{
  if(parentProperty!==''){
   lesArguments=lesArguments+','+parentProperty;
  }
 }
// console.log('lesArguments=',lesArguments); 
 var laPropriete='';

 if(element.callee){
  if(element.callee.property){
   if(element.callee.property.type==="Identifier"){
    if(element.callee.object && element.callee.object.type==='Identifier'){
     t+='appelf(nomf('+element.callee.object.name+'.'+element.callee.property.name+')'+lesArguments+')';
    }else if(element.callee.object && element.callee.object.type==='Literal'){
     t+='appelf(element('+element.callee.object.raw+'),nomf('+element.callee.property.name+')'+lesArguments+')';
    }else{
     if(
      element.callee.object && 
      element.callee.object.type==='MemberExpression' &&
      !(element.callee.object.object && element.callee.object.property && element.callee.object.object.type==='Identifier' && element.callee.object.property.type==='Identifier')
     ){
      // xxx001
      var obj1=traiteMemberExpression1(element.callee.object,niveau,element,'');
      if(obj1.status===true){
       t+='appelf(element('+obj1.value+'),nomf('+element.callee.property.name+')'+lesArguments+')';

      }else{
       return logerreur({status:false,message:'erreur dans traiteCallExpression1 485 ' })
      }
     
     }else{
      laPropriete='prop(appelf(nomf('+element.callee.property.name+')'+lesArguments+'))';
     }
    }
   }else{
    return logerreur({status:false,message:'erreur dans traiteCallExpression1 0604 ' })
   }
  }
  if(element.callee.object){
   if(element.callee.object.type==='CallExpression'){
    var obj1=traiteCallExpression1(element.callee.object , niveau , element , {} );
    if(obj1.status===true){
     t+='appelf('+obj1.value+laPropriete+')';
    }else{
     return logerreur({status:false,message:'erreur dans traiteCallExpression1 0604 ' })
    }
   }else if(element.callee.object.type==='MemberExpression'){
    if(element.callee.object.object && element.callee.object.property && element.callee.object.object.type==='Identifier' && element.callee.object.property.type==='Identifier'){
     t='appelf(element('+element.callee.object.object.name+'['+element.callee.object.property.name+']),nomf('+element.callee.property.name+')'+lesArguments+')';
    }else{
/*
     Traité plus haut en repère xxx001    
     var obj1=traiteMemberExpression1(element.callee.object,niveau,element,'');
     if(obj1.status===true){
      t+='appelf(nomf('+obj1.value+')'+laPropriete+')';
     }else{
      return logerreur({status:false,message:'erreur dans traiteCallExpression1 485 ' })
     }
*/     
    }
   }else if(element.callee.object.type==='Identifier'){
    // pris en compte plus haut
//    t+='appelf(nomf('+element.callee.object.name+')'+laPropriete+')';
   }else if(element.callee.object.type==='Literal'){
    // pris en compte plus haut
   }else{
    return logerreur({status:false,message:'erreur dans traiteCallExpression1 0618 '+element.callee.object.type })
   }
  }else if(element.callee.type==='Identifier'){
   t+='appelf(nomf('+element.callee.name+')'+lesArguments+laPropriete+')';
  }else{
   return logerreur({status:false,message:'erreur dans traiteCallExpression1 0604 ' })
  }
 }
 


 

 return {status:true,value:t}

} 
//=========================================================================================================
function traiteArrayExpression1(element , niveau){

 console.log('%c dans traiteArrayExpression1, element=' , "color:red;font-weight:bold;background:yellow;" , element);
 var t='';
 t+='appelf(';
 t+='n(Array)';
 
 
 var lesPar=''; 
 for( var i in element.elements){
  if(element.elements[i].type==='Literal'){
   lesPar+=',p('+element.elements[i].raw+ ')';
  }else if(element.elements[i].type==='Identifier'){
   lesPar+=',p('+element.elements[i].name+ ')';
  }else if(element.elements[i].type==='ArrayExpression'){
   var obj1=traiteArrayExpression1(element.elements[i],niveau);
   if(obj1.status===true){
    lesPar+=',p('+obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur dans traiteArrayExpression1 567 ' })
   }
  }
 }
 t+=lesPar+')';
 if(t==='appelf(n(Array))'){
  t='[]';
 }
 
 
 return {status:true,value:t} 

}
//=========================================================================================================
function traiteObjectExpression1(element , niveau){

 console.log('%c dans traiteObjectExpression1, element=' , "color:red;font-weight:bold;background:yellow;" , element);

 var t=''; //(todo,todo),(todo,obj((tada,tada),(tada,tada))))';
 for( var i in element.properties){
 
  if(t!==''){
   t+=',';
  }
  var val=element.properties[i];
  
//  console.log(val);
  if(val.key.type==='Identifier'){
   t+='('+val.key.name+ ',';
  }else if(val.key.type==='Literal'){
   t+='('+val.key.raw+ ',';
  }else{
   return logerreur({status:false,message:'erreur dans traiteObjectExpression1 609 '+val.key.type })
   t+='(TODO_FOR_KEY_'+val.key.type+ ' , ';
  }
  
  
  if(val.value.type==='ObjectExpression'){
   var obj1=traiteObjectExpression1(val.value,niveau);
   if(obj1.status===true){
    t+=obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur dans traiteObjectExpression1 567 ' })
   }
  }else if(val.value.type==='Identifier'){
   t+=''+val.value.name+')';
  }else if(val.value.type==='Literal'){
   t+=''+val.value.raw+')';
  }else if(val.value.type==='MemberExpression'){
   var obj1=traiteMemberExpression1(val.value,niveau,val,'');
   if(obj1.status===true){
    t+=obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur traiteObjectExpression1 0799 pour '+eval.value.type });
   }
  }else if(val.value.type==='BinaryExpression'){
   var obj2=traiteBinaryExpress1(val.value,niveau,false)
   if(obj2.status===true){
    t+=''+obj2.value+')';
   }else{
    return logerreur({status:false,message:'erreur traiteObjectExpression1 0993 pour '+element.type });
   }
   
  }else if(val.value.type==='ArrayExpression'){
   var obj1=traiteArrayExpression1(val.value,niveau);
   if(obj1.status===true){
    t+=obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur dans traiteObjectExpression1 1001' })
   }
  }else{
   return logerreur({status:false,message:'erreur dans traiteObjectExpression1 817 '+val.value.type })
  }
 }
 t='obj('+t+')';
 
 
 
 return {status:true,value:t} 
}
//=========================================================================================================
function traiteMemberExpression1(element , niveau,parent,cumulProprieteMembre){ // parentEstAppel
 console.log('%c dans traiteMemberExpression1 element=','color:red;background:yellow;font-weight:bold;',element,'\nparent=',parent);
 var t='';
 var propriete='';
 var razCumulPropMembre=false;
 if(element.computed===false){
  if(element.object){
   if(element.object.type==='Identifier'){ 
    t+=element.object.name;
    if(element.property && element.property.type==='Identifier'){
     t+='.'+element.property.name;
    }else{
     console.error('Dans traiteMemberExpression1 element=',element)
     return logerreur({status:false,message:'erreur traiteMemberExpression1 194 pour '+element.type })
    }
   }else if(element.object.type==='CallExpression'){
    var obj1=traiteCallExpression1(element.object,niveau,element,{},cumulProprieteMembre);
    if(obj1.status===true){
//     t+='appelf('+obj1.value+')';
     t+=''+obj1.value+'';
    }else{
     console.error('Dans traiteMemberExpression1 element=',element)
     return logerreur({status:false,message:'erreur traiteMemberExpression1 237 pour '+element.object.type })
    }
    
   }else if(element.object.type==='MemberExpression'){
   
    if(element.property && element.property.type==='Identifier'){
     cumulProprieteMembre='.'+element.property.name+cumulProprieteMembre;
    }else{
     console.error('Dans traiteMemberExpression1 element=',element)
     return logerreur({status:false,message:'erreur traiteMemberExpression1 549 pour '+element.type });
    }
    
   
    var obj1=traiteMemberExpression1(element.object,niveau,element,cumulProprieteMembre);
    if(obj1.status===true){
     if(obj1.razCumulPropMembre){
      razCumulPropMembre=true;
      t+=obj1.value;
     }else{
      t+=obj1.value+cumulProprieteMembre;
     }
     razCumulPropMembre=true;
     cumulProprieteMembre='';
    }else{
     console.error('Dans traiteMemberExpression1 element=',element)
     return logerreur({status:false,message:'erreur traiteMemberExpression1 427 pour '+element.type });
    }
   }else if(element.object.type==='Literal'){
     t+='['+element.object.raw+']';
   }else{
    console.error('Dans traiteMemberExpression1 element=',element)
    return logerreur({status:false,message:'erreur traiteMemberExpression1 197 pour '+element.object.type })
   }
  }else{
   console.error('Dans traiteMemberExpression1 element=',element)
   return logerreur({status:false,message:'erreur traiteMemberExpression1 1021' })
  }
 }else if(element.computed===true){
  if(element.object && element.object.type==='Identifier'){
   if(element.property && element.property.type==="Literal"){
    t+=element.object.name+'['+element.property.raw+']';
   }else if(element.property && element.property.type==="MemberExpression"){
   
    var obj1=traiteMemberExpression1(element.property,niveau,parent,cumulProprieteMembre);
    if(obj1.status===true){
     t+=element.object.name+'['+obj1.value+']';
    }else{
     console.error('Dans traiteMemberExpression1 element=',element)
     return logerreur({status:false,message:'erreur traiteMemberExpression1 265 pour '+element.type });
    }
    
   }else if(element.property && element.property.type==="Identifier"){

    t+=element.object.name+'['+element.property.name+']';
    
   }else if(element.property && element.property.type==="BinaryExpression"){
   
    var obj1=traiteBinaryExpress1(element.property,niveau,true)
    if(obj1.status===true){
     t+=element.object.name+'['+obj1.value+']';
    }else{
     return logerreur({status:false,message:'erreur traiteMemberExpression1 808 pour '+element.type });
    }
   
   }else{
    console.error('Dans traiteMemberExpression1 element=',element)
    return logerreur({status:false,message:'erreur traiteMemberExpression1 270 pour '+element.property.type })
   }
  }else if(element.object && element.object.type==='MemberExpression'){
  
   var obj1=traiteMemberExpression1(element.object,niveau,element,cumulProprieteMembre);
   if(obj1.status===true){
    t+=''+obj1.value+'';
    if(element.property){
     if(element.property.type==='Literal'){
      t+='['+element.property.raw+']';
     }else if(element.property.type==='Identifier'){
      t+='['+element.property.name+']';
     }else if(element.property.type==='BinaryExpression'){
      var obj2=traiteBinaryExpress1(element.property,niveau,true)
      if(obj2.status===true){
       t+='['+obj2.value+']';
      }else{
       return logerreur({status:false,message:'erreur traiteMemberExpression1 808 pour '+element.type });
      }
     }else{
      console.error('Dans traiteMemberExpression1 element=',element)
      return logerreur({status:false,message:'erreur traiteMemberExpression1 805 pour '+element.type });
     }
    }
   }else{
    console.error('Dans traiteMemberExpression1 element=',element)
    return logerreur({status:false,message:'erreur traiteMemberExpression1 810 pour '+element.type });
   }
   
  }else{
   console.error('Dans traiteMemberExpression1 element=',element)
   return logerreur({status:false,message:'erreur traiteMemberExpression1 815 pour '+element.object.type })
  }
 
 }else{
  if(element.type==='Literal'){
   t+=element.raw;
  }else{
   console.error('Dans traiteMemberExpression1 element=',element);
   return logerreur({status:false,message:'erreur traiteMemberExpression1 0823 pour '+element.type })
  }
 } 
 return {status:true,value:t,prop:propriete,'razCumulPropMembre':razCumulPropMembre} 
}
//=========================================================================================================
function traiteUpdateExpress1(element , niveau , opt){

 console.log('%c dans traiteUpdateExpress1 , element=',"color:red;background:yellow;",element);

 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var LF='\n';
 
 if(opt['sansLF']){
  LF='';
  esp0='';
  esp1='';
 }
 if('Identifier'===element.argument.type){
  if('++'===element.operator && element.prefix==false){
   t+='affecte('+element.argument.name+','+element.argument.name+'+1)';
  }else if('--'===element.operator && element.prefix==false){
   t+='affecte('+element.argument.name+','+element.argument.name+'-1)';
  }else{
   return logerreur({status:false,message:'erreur traiteUpdateExpress1 867 pour '+element.argument.operator });
  }
 }else{
  return logerreur({status:false,message:'erreur traiteUpdateExpress1 628 pour '+element.argument.type });
 }
 return {status:true,value:t};


}
//=========================================================================================================
function traiteAssignmentExpress1(element , niveau , opt){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var LF='\n';
 
 if(opt['sansLF']){
  LF='';
  esp0='';
  esp1='';
 }
// console.log('dans traiteAssignmentExpress1 , element=',element);

 if(element.left && element.left.type==="Identifier"){
  if(element.operator==='='){
//   t=LF+esp0+'affecte('+element.left.name+' , ';
   valeurLeft=LF+esp0+'affecte('+element.left.name+' , ';
  }else{
//   t=LF+esp0+'affectop(\''+element.operator+'\' , '+element.left.name+' , ';
   valeurLeft=LF+esp0+'affectop(\''+element.operator+'\' , '+element.left.name+' , ';
  }
  if(element.right && element.right.type==="Literal"){
   t+=valeurLeft+element.right.raw+')';
  }else if(element.right && element.right.type==="MemberExpression"){
   var obj1=traiteMemberExpression1(element.right,niveau,element,'');
   if(obj1.status===true){
    t+=valeurLeft+obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur traiteAssignmentExpress1 301 pour '+element.type });
   }
//  }else if(
//  
  }else if(element.right && element.right.type==="BinaryExpression"){
   obj1=traiteBinaryExpress1(element.right,niveau,false)
   if(obj1.status===true){
    t+=valeurLeft+obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur traiteAssignmentExpress1 452 pour '+element.type });
   }
  }else if(element.right && element.right.type==="CallExpression"){
   var obj1=traiteCallExpression1(element.right,niveau,element,{'sansLF':true});
   if(obj1.status===true){
    t+=valeurLeft+obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur pour traiteAssignmentExpress1 780 '+element.type })
   }
   
  }else if(element.right && element.right.type==="Identifier"){
   t+=valeurLeft+element.right.name+')';
  }else if(element.right && element.right.type==="UnaryExpression"){
  
   var nomDuTestUnary=recupNomOperateur(element.right.operator);
   var nomDuTest=recupNomOperateur(element.operator);
   if(element.right && element.right.type==='Literal' && element.right.argument.type==='Identifier'){
    t+=valeurLeft+nomDuTest+'('+nomDuTestUnary+'('+element.right.argument.name+')'+','+element.right.raw+'))';
   }else if( ( element.right.operator==='-'||element.right.operator==='+' ) && element.right.type=="UnaryExpression" && element.right.argument.type==='Literal' ){
    t+=valeurLeft+element.right.operator+''+element.right.argument.raw+')';
   }else if( ( element.right.operator==='-'||element.right.operator==='+' ) && element.right.type=="UnaryExpression" && element.right.argument.type==='Identifiel' ){
    t+=valeurLeft+element.right.operator+''+element.right.argument.name+')';
   }else if(element.right.operator==='!' && element.right.type=="UnaryExpression" && element.right.argument.type==='CallExpression'){
    
    var obj1=traiteCallExpression1(element.right.argument,niveau,element.right,{'sansLF':true});
    if(obj1.status===true){
     t+=valeurLeft+'condition(non('+obj1.value+'))'+')';
    }else{
     return logerreur({status:false,message:'erreur pour traiteAssignmentExpress1 780 '+element.type })
    }
   
   }else{
    
    return logerreur({'status':false,'message':'erreur dans traiteAssignmentExpress1 0934 '});
   }
  
  }else if(element.right && element.right.type==="AssignmentExpression"){
   var objass=traiteAssignmentExpress1(element.right,niveau,{'sansLF':true});
   if(objass.status===true){
    t+=valeurLeft+objass.value+')';
   }else{
    return logerreur({status:false,message:'erreur traiteAssignmentExpress1 1020 pour '+element.type });
   }
  }else if(element.right && element.right.type==="ObjectExpression"){
   var obj1=traiteObjectExpression1(element.right,niveau);
   if(obj1.status===true){
    t+=valeurLeft+obj1.value+')';
   }else{
    return logerreur({status:false,message:'erreur dans traiteAssignmentExpress1 1027' })
   }
   
  }else if(element.right && element.right.type==="LogicalExpression"){

   var obj1=traiteLogicalExpression1(element.right,niveau);
   if(obj1.status===true){
    t+=valeurLeft+'condition('+obj1.value+'))';

   }else{
    return logerreur({status:false,message:'erreur dans traiteAssignmentExpress1 1181' })
   }

  }else{
   return logerreur({status:false,message:'erreur traiteAssignmentExpress1 1023 pour '+element.right.type });
  }
  
 }else if(element.left && element.left.type==="MemberExpression"){
 
  var obj2=traiteMemberExpression1(element.left,niveau,element,'');
  if(obj2.status===true){
   
   if(element.right && element.right.type==="Literal"){
   
    if(element.operator==='='){
     t=LF+esp0+'affecte('+obj2.value+' , ';
    }else{
     t=LF+esp0+'affectop(\''+element.operator+'\' , '+obj2.value+' , ';
    }
    t+=element.right.raw+')';

   }else if(element.right && element.right.type==="Identifier"){

    if(element.operator==='='){
     t=LF+esp0+'affecte('+obj2.value+' , ';
    }else{
     t=LF+esp0+'affectop(\''+element.operator+'\' , '+obj2.value+' , ';
    }
    t+=element.right.name+')';
    
   }else if(element.right && element.right.type==="MemberExpression"){
   
    if(element.operator==='='){
     t=LF+esp0+'affecte('+obj2.value+' , ';
    }else{
     t=LF+esp0+'affectop(\''+element.operator+'\' , '+obj2.value+' , ';
    }
    var obj1=traiteMemberExpression1(element.right,niveau,element,'');
    if(obj1.status===true){
     t+=obj1.value+')';
    }else{
     return logerreur({status:false,message:'erreur traiteAssignmentExpress1 318 pour '+element.type });
    }
   
   }else if('BinaryExpression'===element.right.type){
    if(element.operator==='='){
     t=LF+esp0+'affecte('+obj2.value+' , ';
    }else{
     t=LF+esp0+'affectop(\''+element.operator+'\' , '+obj2.value+' , ';
    }
    obj1=traiteBinaryExpress1(element.right,niveau,false)
    if(obj1.status===true){
     t+=obj1.value+')';
    }else{
     return logerreur({status:false,message:'erreur traiteAssignmentExpress1 452 pour '+element.type });
    }
    
   }else if('FunctionExpression'===element.right.type){
    
    t+=LF+esp0+'affecteFonction('
    t+=LF+esp0+esp1+obj2.value+' , ';
    t+=LF+esp0+esp1+'appelf(';
    t+=LF+esp0+esp1+esp1+'n(function)';
    if(element.right.params && element.right.params.length>0){
     t+=',';
     for(var j=0;j<element.right.params.length;j++){
      t+='\n'+esp0+esp1+esp1+'p('+element.right.params[j].name+')';
      t+=',';
     }
    }
    t+=LF+esp0+esp1+esp1+''+'contenu(';
    var bodyTrouve=false;
    for( var prop in element.right ){
//     console.log('prop='+prop);
     if(prop=='body'){
//      console.log('on a troyvé body, element.right[prop]=' , element.right[prop] );
      bodyTrouve=true;
      niveau+=2;
      var obj=TransformAstEnRev(element.right[prop],niveau);
      niveau-=2;
      if(obj.status===true){
       t+=LF+esp0+esp1+esp1+esp1;
       t+=obj.value;
      }else{
       return logerreur({status:false,message:'erreur pour traiteAssignmentExpress1 229 '+element.type })
      }
     }
    }
    t+=LF+esp0+esp1+esp1+')';
    t+=LF+esp0+esp1+')';
    t+=LF+esp0+')';
   
   }else if('CallExpression'===element.right.type){

    var obj1=traiteCallExpression1(element.right,niveau,element,{'sansLF':true});
    if(obj1.status===true){

     if(element.operator==='='){
      t=LF+esp0+'affecte('+obj2.value+' , ';
     }else{
      t=LF+esp0+'affectop(\''+element.operator+'\' , '+obj2.value+' , ';
     }
     t+=obj1.value+')';
    }else{
     return logerreur({status:false,message:'erreur pour traiteAssignmentExpress1 1232 '+element.type })
    }
    
   }else{
    return logerreur({status:false,message:'erreur traiteExpression1 1223 pour '+element.right.type });
   }
  }else{
   return logerreur({status:false,message:'erreur traiteExpression1 305 pour '+element.type });
  }
 
 }else{
  return logerreur({status:false,message:'erreur traiteExpression1 214 pour '+element.type })
 }

 
 return {status:true,value:t}
 
 
}
//=========================================================================================================
function traiteExpression1(element , niveau){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 
 console.log('%c dans traiteExpression1 element=','color:red;background:yellow;font-weight:bold;',element);
 
 
 if('ExpressionStatement' === element.type){
//  console.log('element.expression=',element.expression);
  if('AssignmentExpression'===element.expression.type){
   var objass=traiteAssignmentExpress1(element.expression,niveau,{});
   if(objass.status===true){
    t+=objass.value;
   }else{
    return logerreur({status:false,message:'erreur traiteExpression1 318 pour '+element.type });
   }

  }else if('UpdateExpression'===element.expression.type){
   var objass=traiteUpdateExpress1(element.expression,niveau,{'sansLF':true});
   if(objass.status===true){
    t+=objass.value+'';
   }else{
    return logerreur({status:false,message:'erreur traiteExpression1 765 pour '+element.type });
   }
  }else if("CallExpression"===element.expression.type){
   var obj1=traiteCallExpression1(element.expression,niveau,element,{});
   if(obj1.status===true){
    t+=obj1.value+'';
   }else{
    return logerreur({status:false,message:'erreur pour traiteExpression1 827 '+element.type })
   }
  
  }else if("Literal"===element.expression.type && element.directive){
   if(element.directive=='use strict'){
    t+='useStrict()';
   }else{
    return logerreur({status:false,message:'erreur pour traiteExpression1 1127 '+element.type })
   }
  }else if("ExpressionStatement"===element.expression.type){
   var objexp1=traiteExpression1(element.expression,niveau);
   if(objexp1.status==true){
    t+=objexp1.value;
   }else{
    return logerreur({status:false,message:'erreur pour traiteExpression1 1134 '+element.type })
   }
  }else if("MemberExpression"===element.expression.type){
   var obj1=traiteMemberExpression1(element.expression,niveau,element,'');
   if(obj1.status===true){
    t+=obj1.value;
   }else{
    return logerreur({status:false,message:'erreur pour traiteDeclaration1 928 '+element.type })
   }
  }else{
   return logerreur({status:false,message:'erreur traiteExpression1 1124 pour '+element.expression.type })
  }
 }else{
  return logerreur({status:false,message:'erreur traiteExpression1 1037 pour '+element.type })
 }
 
 return {status:true,value:t}
}

//=========================================================================================================
function traiteDeclaration1(element,niveau){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 var nomVariable='';
 
 for( var decl in element.declarations){
//  console.log(element.declarations[decl]);
  if(t!==''){
   t+=',';
  }
  var debutDeclaration='';
//  t+='\n'+esp0+'declare('+element.declarations[decl].id.name + ' , ';
  debutDeclaration='\n'+esp0+'declare('+element.declarations[decl].id.name+' , ';
  nomVariable=element.declarations[decl].id.name;
  if(element.declarations[decl].init){
   if("Literal"===element.declarations[decl].init.type){

    t+=debutDeclaration+element.declarations[decl].init.raw+')';

   }else if("Identifier"===element.declarations[decl].init.type){
   
    t+=debutDeclaration+element.declarations[decl].init.name+')';
    
   }else if("MemberExpression"===element.declarations[decl].init.type){

    var obj1=traiteMemberExpression1(element.declarations[decl].init,niveau,element,'');
    if(obj1.status===true){
     t+=debutDeclaration+obj1.value+')';
    }else{
     return logerreur({status:false,message:'erreur pour traiteDeclaration1 928 '+element.type })
    }

   }else if("CallExpression"===element.declarations[decl].init.type){

    var obj1=traiteCallExpression1(element.declarations[decl].init,niveau,element,{});
    if(obj1.status===true){
     t+=debutDeclaration+obj1.value+')';
    }else{
     return logerreur({status:false,message:'erreur pour traiteDeclaration1 935 '+element.type })
    }

   }else if("ObjectExpression"===element.declarations[decl].init.type){

    var obj1=traiteObjectExpression1(element.declarations[decl].init,niveau);
    if(obj1.status===true){
     t+=debutDeclaration+obj1.value+')';
    }else{
     return logerreur({status:false,message:'erreur dans traiteDeclaration1 534' })
    }

   }else if("UnaryExpression"===element.declarations[decl].init.type){

    if(element.declarations[decl].init.argument && element.declarations[decl].init.argument.type==='Literal'){
     t+=debutDeclaration+ element.declarations[decl].init.operator + element.declarations[decl].init.argument.raw + ')';
    }else{
     return logerreur({status:false,message:'erreur pas de callee dans traiteCallExpression1 517' })
    }

   }else if("LogicalExpression"===element.declarations[decl].init.type){
    var obj=traiteLogicalExpression1(element.declarations[decl].init,niveau);
    if(obj.status===true){
     if(obj.value.substr(0,1)===','){
      t+=debutDeclaration+'condition('+obj.value.substr(1)+'))';
     }else{
      t+=debutDeclaration+'condition('+obj.value+'))';
     }
    }else{
     return logerreur({'status':false,'message':'erreur dans traiteCondition1 1545 '});
    }
    
   }else if("NewExpression"===element.declarations[decl].init.type){
   
    var obj1=traiteCallExpression1(element.declarations[decl].init,niveau,element,{});
    if(obj1.status===true){
     t+=debutDeclaration+'new('+obj1.value+'))';
    }else{
     return logerreur({status:false,message:'erreur pour traiteDeclaration1 935 '+element.type })
    }

   }else{
   
    t+=debutDeclaration+'"todo 1550  pour '+element.declarations[decl].init.type+'")';
    
   }
  }else{
   t+=debutDeclaration+'obj())';
  }
 }
 return {status:true,value:t,'nomVariable':nomVariable}

}
//=========================================================================================================
function traiteTry1(element,niveau){
// console.log('%c dans traiteTry1, element=' , "color:green;font-weight:bold;background:yellow;" , element);

 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 t+='\n'+esp0+'essayer('
 t+='\n'+esp0+esp1+'faire('
 niveau+=2;
 var obj=TransformAstEnRev(element.block.body,niveau);
 if(obj.status===true){
  t+='\n'+esp0+esp1+esp1+esp1+obj.value;
 }else{
  return logerreur({status:false,message:'erreur pour '+element.type })
 }
 niveau-=2;
 
 
 
 t+='\n'+esp0+esp1+'),'
 t+='\n'+esp0+esp1+'sierreur('
 
 if(element.handler && element.handler.type=="CatchClause"){
  if(element.handler.param && element.handler.param.type==='Identifier'){
   t+='\n'+esp0+esp1+esp1+element.handler.param.name+',';
  }else{
   return logerreur({status:false,message:'erreur dans traiteTry1 1021, il manque le nom de la variable capturant l\'erreur : erreur pour '+element.type })
  }
  if(element.handler.body && element.handler.body.type==='BlockStatement'){
   niveau+=2;
   var obj=TransformAstEnRev(element.handler.body,niveau);
   niveau-=2;
   if(obj.status===true){
    t+='\n'+esp0+esp1+esp1+'faire(';
    if(obj.value==''){
     t+='#(rien)';
     t+=')';
    }else{
     t+='\n'+esp0+esp1+esp1+esp1+obj.value;
     t+='\n'+esp0+esp1+esp1+')';
    }
   }else{
    return logerreur({status:false,message:'erreur pour '+element.type })
   }
  }
 }
 
 
 t+='\n'+esp0+esp1+')'; // fermeture sierreur
 t+='\n'+esp0+')'; // fermeture essayer
 
 
 return {status:true,value:t}
}
//=========================================================================================================
function TransformAstEnRev(objectEsprimaBody,niveau){
 var t='';
 var esp0=' '.repeat(NBESPACESREV*niveau);
 var esp1=' '.repeat(NBESPACESREV);
 
// console.log('entrée dans le récursif avec objectEsprimaBody=',objectEsprimaBody);
 // dans le body, il peut y avoir plusieurs éléments 0,1,2 ... n
 if(objectEsprimaBody.length){
  for(var i=0;i<objectEsprimaBody.length;i++){
   var element=objectEsprimaBody[i];
   var bodyTrouve=false;
//   console.log('element.type='+element.type,element);

   if(t!=''){
    t+=',';
   }

   if(element.type=='FunctionDeclaration'){
   
   
//    console.log('dans FunctionDeclaration');
    t+='\n'+esp0+'fonction(';
    t+='\n'+esp0+esp1+'definition(';
    t+='\n'+esp0+esp1+esp1+'nom('+element.id.name+')';
    if(element.params && element.params.length>0){
     t+=',';
     for(var j=0;j<element.params.length;j++){
      t+='\n'+esp0+esp1+esp1+'argument('+element.params[j].name+')';
      if(j<element.params.length-1){
       t+=',';
      }
     }
    }
    t+='\n'+esp0+esp1+'),';
    t+='\n'+esp0+esp1+'contenu(';
    for( var prop in element ){
//     console.log('prop='+prop);
     if(prop=='body'){
//      console.log('on a troyvé body, element[prop]=' , element[prop] );
      bodyTrouve=true;
      niveau++;
      var obj=TransformAstEnRev(element[prop],niveau);
      niveau--;
      if(obj.status===true){
       t+=obj.value;
      }else{
       return logerreur({status:false,message:'erreur pour TransformAstEnRev 229 '+element.type })
      }
     }
    }
    t+='\n'+esp0+esp1+')';
    t+='\n'+esp0+')';
    
    
   }else if(element.type=='VariableDeclaration'){
   
   
//    console.log('element.type='+element.type,element.declarations);
    var objDecl=traiteDeclaration1(element,niveau);
    if(objDecl.status===true){
     t+=objDecl.value;
    }else{
     return logerreur({status:false,message:'erreur pour TransformAstEnRev 471 '+element.type })
    }
    
   }else if("IfStatement"===element.type){
   
     
     var objif=traiteIf1(element,niveau,'if');
     if(objif.status==true){
      t+=objif.value;
     }else{
      return logerreur({status:false,message:'erreur pour TransformAstEnRev 261 '+element.type })
     }

   }else if("ForInStatement"===element.type){

     var objFor=traiteForIn1(element,niveau);
     if(objFor.status==true){
      t+=objFor.value;
     }else{
      return logerreur({status:false,message:'erreur pour TransformAstEnRev 466 '+element.type })
     }
   

   }else if("ForStatement"===element.type){
   
     
     var objFor=traiteFor1(element,niveau);
     if(objFor.status==true){
      t+=objFor.value;
     }else{
      return logerreur({status:false,message:'erreur pour TransformAstEnRev 466 '+element.type })
     }

   
   }else if('ExpressionStatement'===  element.type){

     var objexp1=traiteExpression1(element,niveau);
     if(objexp1.status==true){
      t+=objexp1.value;
     }else{
      return logerreur({status:false,message:'erreur pour TransformAstEnRev 1036 '+element.type })
     }
   
    
   }else if('ReturnStatement'===  element.type){
    if(element.argument===null){
     t+='\n'+esp0+'revenir()';
    }else if(element.argument && element.argument.type=='Identifier'){
     t+='\n'+esp0+'revenir('+element.argument.name+')';
    }else if(element.argument && element.argument.type=="CallExpression"){
     var obj1=traiteCallExpression1(element.argument,niveau,element,{'sansLF':true});
     if(obj1.status===true){
      t+='\n'+esp0+'revenir('+obj1.value+')';
     }else{
      console.error('Dans TransformAstEnRev 1220 element=',element)
      return logerreur({status:false,message:'erreur TransformAstEnRev 1221 ' })
     }
    }else if(element.argument && element.argument.type=="Literal"){
     t+='\n'+esp0+'revenir('+element.argument.raw+')';
    }else{
     return logerreur({status:false,message:'erreur pour TransformAstEnRev 1044 '+element.argument.type })
    }

   }else if("TryStatement" ===  element.type){
   
     var objtry1=traiteTry1(element,niveau);
     if(objtry1.status==true){
      t+=objtry1.value;
     }else{
      return logerreur({status:false,message:'erreur pour TransformAstEnRev 1055 '+element.type })
     }
   
   }else if("BreakStatement" ===  element.type){
   
     t+='\n'+esp0+'break()';

   }else if("ContinueStatement" ===  element.type){
   
     t+='\n'+esp0+'continue()';
   
   }else{
   
    logerreur({status:false,message:'erreur922 pour '+element.type })
   
    console.error('non pris en compte element.type='+element.type,element);
    for( var prop in element ){
     if(prop=='body'){
      bodyTrouve=true;
      var obj=TransformAstEnRev(element[prop],niveau);
      if(obj.status===true){
       t+=obj.value;
      }else{
       return logerreur({status:false,message:'erreur pour '+element.type })
      }
     }
    }
   }
   if(!bodyTrouve){
//    console.log('body non trouvé pour '+element.type);
   }
  
  }
 }else{
//  console.log('Pas de length pour '+objectEsprimaBody.type)
  if(objectEsprimaBody.type==='BlockStatement'){
   if(objectEsprimaBody.body){
    niveau++;
    var obj=TransformAstEnRev(objectEsprimaBody.body,niveau);
    if(obj.status===true){
     t+=obj.value;
    }else{
     return logerreur({status:false,message:'erreur pour '+element.type })
    }
    niveau--;
   }else{
    console.log('Pas de body pour '+objectEsprimaBody.type)
   }
  }
 }
// console.log('sortie du récursif')
 return({status:true,value:t});
 
} 



//=====================================================================================================================
function transform(){
  //"àà"

  console.log('=========================\ndébut de transforme')
  document.getElementById('txtar2').value='';
  document.getElementById('resultat1').innerHTML='';
  clearMessages('zone_global_messages');
  var a=document.getElementById('txtar1');
  localStorage.setItem("fta_indexhtml_javascript_dernier_fichier_charge", a.value);
  
  var lines = a.value.split(/\r|\r\n|\n/);
  
  var count = lines.length;
  a.setAttribute('rows',count+1);
  
//  console.log('a compiler="'+a.value+'"');
  try{
  
/*  
   var ret=esprima.parseScript(
    a.value, 
    {} , 
    function (node, meta){
        console.log('meta=',meta);
        if(node.type === 'VariableDeclaration'){
         console.log('VariableDeclaration');
        }else if(node.type === 'FunctionDeclaration'){ 
         console.log('FunctionDeclaration');
        }else if(node.type === 'FunctionExpression'){ 
         console.log('FunctionExpression');
        }else{
         console.log('pas encore implémenté' , node.type, node);
        }
    }
   );
   console.log('ret.body=',ret.body);
   
*/

   var ret=esprima.parseScript(a.value);
//   console.log('ret.body=',ret.body);
   var obj=TransformAstEnRev(ret.body,0);
   if(obj.status==true){
    console.log('\n\n\n===================\n\n\nretour parsing js ='+obj.status+'\n=====================\n'+obj.value);
    document.getElementById('resultat1').innerHTML='<pre>'+obj.value.replace(/&/g,'&amp;').replace(/</g,'&lt;')+'</pre>'; //  style="white-space: normal;"
    document.getElementById('txtar2').value=obj.value;
   }

   
  }catch(e){
   console.log('erreur esprima',e);
  }
  
  
  displayMessages('zone_global_messages');
 
}
//=====================================================================================================================
//=====================================================================================================================
//=====================================================================================================================
function chargerSourceDeTest(){
// debut de backtic ``` ci dessous pour la variable t = = = = = = = = = = = = = = = = = = = = = = = = = 
 var t=`/*
a.b("c").d += '<e f="g">' + h.i[i] + "</e>";

for (var i = 0; i < b; i++) {
  a.b("c").d += '<e>' + h.i[i] + "</e>";
}
t = " ".repeat(NBESPACESSOURCEPRODUIT * i);
t += " ".repeat(NBESPACESSOURCEPRODUIT * i);



//==========================================================================================
//testé
function traiteCommentaire2(texte, niveau, ind) {
  var s = "";
  s = traiteCommentaireSourceEtGenere1(texte, niveau, ind, NBESPACESSOURCEPRODUIT, false);
  return s;
}

function displayMessages() {
  for (var i = 0; i < global_messages.errors.length; i++) {
    document.getElementById("global_messages").innerHTML += '<div class="yyerror">' + global_messages.errors[i] + "</div>";
  }
  for (var i = 0; i < global_messages.lines.length; i++) {
    document.getElementById("global_messages").innerHTML += '<a href="javascript:jumpToError(' + (global_messages.lines[i] + 1) + ')" class="yyerror" style="border:2px red outset;">go to line ' + global_messages.lines[i] + "</a>&nbsp;";
  }
  var numLignePrecedente = -1;
  for (var i = 0; i < global_messages.ids.length; i++) {
    var id = global_messages.ids[i];
    if (id < global_messages.data.matrice.value.length) {
      var ligneMatrice = global_messages.data.matrice.value[id];
      var caractereDebut = ligneMatrice[5];
      var numeroDeLigne = 0;
      for (var j = caractereDebut; j >= 0; j--) {
        if (global_messages.data.tableau.out[j][0] == "\n") {
          numeroDeLigne++;
        }
      }
    }
    if (numeroDeLigne > 0) {
      if (numeroDeLigne != numLignePrecedente) {
        document.getElementById("global_messages").innerHTML += '<a href="javascript:jumpToError(' + (numeroDeLigne + 1) + ')" class="yyerror" style="border:2px red outset;">go to line ' + numeroDeLigne + "</a>&nbsp;";
        numLignePrecedente = numeroDeLigne;
      }
    }
  }
}

function espacesn(optionCRLF, i) {
  var t = "";
  if (optionCRLF) {
    t = "\r\n";
  } else {
    t = "\n";
  }
  if (i > 0) {
    t += " ".repeat(NBESPACESSOURCEPRODUIT * i);
  }
  return t;
}



*/`;




// fin de backtic ``` ci dessus pour la variable t = = = = = = = = = = = = = = = = = = = = = = = = = 
 dogid('txtar1').value=t;
}
//=====================================================================================================================
function chargerLeDernierSource(){
 var fta_indexhtml_javascript_dernier_fichier_charge=localStorage.getItem("fta_indexhtml_javascript_dernier_fichier_charge");
// console.log('fta_indexhtml_javascript_dernier_fichier_charge=' , fta_indexhtml_javascript_dernier_fichier_charge );
 if(fta_indexhtml_javascript_dernier_fichier_charge!==null){
  dogid('txtar1').value=fta_indexhtml_javascript_dernier_fichier_charge;
 }
}

chargerLeDernierSource();
transform();
</script>
  
</body></html>